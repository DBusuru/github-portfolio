var rrwebReplay=function(ut){"use strict";var C;(function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"})(C||(C={}));function Te(e){return e.nodeType===e.ELEMENT_NODE}class xt{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var n;if(!t)return-1;const i=(n=this.getMeta(t))===null||n===void 0?void 0:n.id;return i??-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){const n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach(i=>this.removeNodeFromMap(i))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,n){const i=n.id;this.idNodeMap.set(i,t),this.nodeMetaMap.set(t,n)}replace(t,n){const i=this.getNode(t);if(i){const r=this.nodeMetaMap.get(i);r&&this.nodeMetaMap.set(n,r)}this.idNodeMap.set(t,n)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function be(){return new xt}function Se(e){return e.toLowerCase()}function we(e,t){return!e||!t||e.type!==t.type?!1:e.type===C.Document?e.compatMode===t.compatMode:e.type===C.DocumentType?e.name===t.name&&e.publicId===t.publicId&&e.systemId===t.systemId:e.type===C.Comment||e.type===C.Text||e.type===C.CDATA?e.textContent===t.textContent:e.type===C.Element?e.tagName===t.tagName&&JSON.stringify(e.attributes)===JSON.stringify(t.attributes)&&e.isSVG===t.isSVG&&e.needBlock===t.needBlock:!1}const At=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;function Me(e,t={}){let n=1,i=1;function r(f){const p=f.match(/\n/g);p&&(n+=p.length);const T=f.lastIndexOf(`
`);i=T===-1?i+f.length:f.length-T}function a(){const f={line:n,column:i};return p=>(p.position=new o(f),v(),p)}class o{constructor(p){this.start=p,this.end={line:n,column:i},this.source=t.source}}o.prototype.content=e;const s=[];function c(f){const p=new Error(`${t.source||""}:${n}:${i}: ${f}`);if(p.reason=f,p.filename=t.source,p.line=n,p.column=i,p.source=e,t.silent)s.push(p);else throw p}function l(){const f=h();return{type:"stylesheet",stylesheet:{source:t.source,rules:f,parsingErrors:s}}}function u(){return g(/^{\s*/)}function d(){return g(/^}/)}function h(){let f;const p=[];for(v(),N(p);e.length&&e.charAt(0)!=="}"&&(f=K()||ct());)f&&(p.push(f),N(p));return p}function g(f){const p=f.exec(e);if(!p)return;const T=p[0];return r(T),e=e.slice(T.length),p}function v(){g(/^\s*/)}function N(f=[]){let p;for(;p=S();)p&&f.push(p),p=S();return f}function S(){const f=a();if(e.charAt(0)!=="/"||e.charAt(1)!=="*")return;let p=2;for(;e.charAt(p)!==""&&(e.charAt(p)!=="*"||e.charAt(p+1)!=="/");)++p;if(p+=2,e.charAt(p-1)==="")return c("End of comment missing");const T=e.slice(2,p-2);return i+=2,r(T),e=e.slice(p),i+=2,f({type:"comment",comment:T})}function m(){for(v();e[0]=="}";)c("extra closing bracket"),e=e.slice(1),v();const f=g(/^(("(?:\\"|[^"])*"|'(?:\\'|[^'])*'|[^{])+)/);if(!f)return;const p=f[0].trim().replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,T=>T.replace(/,/g,"\u200C"));return E(p).map(T=>T.replace(/\u200C/g,",").trim())}function E(f){const p=[];let T="",O=0,P=0;for(const F of f)F==="("?O++:F===")"?O--:F==="["?P++:F==="]"&&P--,F===","&&O===0&&P===0?(p.push(T),T=""):T+=F;return T&&p.push(T),p}function y(){const f=a(),p=g(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(!p)return;const T=B(p[0]);if(!g(/^:\s*/))return c("property missing ':'");const O=g(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/),P=f({type:"declaration",property:T.replace(At,""),value:O?B(O[0]).replace(At,""):""});return g(/^[;\s]*/),P}function M(){const f=[];if(!u())return c("missing '{'");N(f);let p;for(;p=y();)p!==!1&&(f.push(p),N(f)),p=y();return d()?f:c("missing '}'")}function A(){let f;const p=[],T=a();for(;f=g(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)p.push(f[1]),g(/^,\s*/);if(p.length)return T({type:"keyframe",values:p,declarations:M()})}function L(){const f=a();let p=g(/^@([-\w]+)?keyframes\s*/);if(!p)return;const T=p[1];if(p=g(/^([-\w]+)\s*/),!p)return c("@keyframes missing name");const O=p[1];if(!u())return c("@keyframes missing '{'");let P,F=N();for(;P=A();)F.push(P),F=F.concat(N());return d()?f({type:"keyframes",name:O,vendor:T,keyframes:F}):c("@keyframes missing '}'")}function V(){const f=a(),p=g(/^@supports *([^{]+)/);if(!p)return;const T=B(p[1]);if(!u())return c("@supports missing '{'");const O=N().concat(h());return d()?f({type:"supports",supports:T,rules:O}):c("@supports missing '}'")}function J(){const f=a();if(!g(/^@host\s*/))return;if(!u())return c("@host missing '{'");const p=N().concat(h());return d()?f({type:"host",rules:p}):c("@host missing '}'")}function wt(){const f=a(),p=g(/^@media *([^{]+)/);if(!p)return;const T=B(p[1]);if(!u())return c("@media missing '{'");const O=N().concat(h());return d()?f({type:"media",media:T,rules:O}):c("@media missing '}'")}function Mt(){const f=a(),p=g(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(p)return f({type:"custom-media",name:B(p[1]),media:B(p[2])})}function Dt(){const f=a();if(!g(/^@page */))return;const p=m()||[];if(!u())return c("@page missing '{'");let T=N(),O;for(;O=y();)T.push(O),T=T.concat(N());return d()?f({type:"page",selectors:p,declarations:T}):c("@page missing '}'")}function Z(){const f=a(),p=g(/^@([-\w]+)?document *([^{]+)/);if(!p)return;const T=B(p[1]),O=B(p[2]);if(!u())return c("@document missing '{'");const P=N().concat(h());return d()?f({type:"document",document:O,vendor:T,rules:P}):c("@document missing '}'")}function at(){const f=a();if(!g(/^@font-face\s*/))return;if(!u())return c("@font-face missing '{'");let p=N(),T;for(;T=y();)p.push(T),p=p.concat(N());return d()?f({type:"font-face",declarations:p}):c("@font-face missing '}'")}const Ct=I("import"),Rt=I("charset"),lt=I("namespace");function I(f){const p=new RegExp("^@"+f+"\\s*([^;]+);");return()=>{const T=a(),O=g(p);if(!O)return;const P={type:f};return P[f]=O[1].trim(),T(P)}}function K(){if(e[0]==="@")return L()||wt()||Mt()||V()||Ct()||Rt()||lt()||Z()||Dt()||J()||at()}function ct(){const f=a(),p=m();return p?(N(),f({type:"rule",selectors:p,declarations:M()})):c("selector missing")}return dt(l())}function B(e){return e?e.replace(/^\s+|\s+$/g,""):""}function dt(e,t){const n=e&&typeof e.type=="string",i=n?e:t;for(const r of Object.keys(e)){const a=e[r];Array.isArray(a)?a.forEach(o=>{dt(o,i)}):a&&typeof a=="object"&&dt(a,i)}return n&&Object.defineProperty(e,"parent",{configurable:!0,writable:!0,enumerable:!1,value:t||null}),e}const It={script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};function De(e){let t=It[e.tagName]?It[e.tagName]:e.tagName;return t==="link"&&e.attributes._cssText&&(t="style"),t}function Ot(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const kt=/(max|min)-device-(width|height)/,Ce=new RegExp(kt.source,"g"),_t=/([^\\]):hover/,Re=new RegExp(_t.source,"g");function Lt(e,t){const n=t?.stylesWithHoverClass.get(e);if(n)return n;const i=Me(e,{silent:!0});if(!i.stylesheet)return e;const r=[],a=[];function o(c){"selectors"in c&&c.selectors&&c.selectors.forEach(l=>{_t.test(l)&&r.push(l)}),"media"in c&&c.media&&kt.test(c.media)&&a.push(c.media),"rules"in c&&c.rules&&c.rules.forEach(o)}o(i.stylesheet);let s=e;if(r.length>0){const c=new RegExp(r.filter((l,u)=>r.indexOf(l)===u).sort((l,u)=>u.length-l.length).map(l=>Ot(l)).join("|"),"g");s=s.replace(c,l=>{const u=l.replace(Re,"$1.\\:hover");return`${l}, ${u}`})}if(a.length>0){const c=new RegExp(a.filter((l,u)=>a.indexOf(l)===u).sort((l,u)=>u.length-l.length).map(l=>Ot(l)).join("|"),"g");s=s.replace(c,l=>l.replace(Ce,"$1-$2"))}return t?.stylesWithHoverClass.set(e,s),s}function Pt(){return{stylesWithHoverClass:new Map}}function xe(e,t){var n;const{doc:i,hackCss:r,cache:a}=t;switch(e.type){case C.Document:return i.implementation.createDocument(null,"",null);case C.DocumentType:return i.implementation.createDocumentType(e.name||"html",e.publicId,e.systemId);case C.Element:{const o=De(e);let s;e.isSVG?s=i.createElementNS("http://www.w3.org/2000/svg",o):(e.isCustom&&((n=i.defaultView)===null||n===void 0?void 0:n.customElements)&&!i.defaultView.customElements.get(e.tagName)&&i.defaultView.customElements.define(e.tagName,class extends i.defaultView.HTMLElement{}),s=i.createElement(o));const c={};for(const l in e.attributes){if(!Object.prototype.hasOwnProperty.call(e.attributes,l))continue;let u=e.attributes[l];if(o==="option"&&l==="selected"&&u===!1||u===null)continue;if(u===!0&&(u=""),l.startsWith("rr_")){c[l]=u;continue}const d=o==="textarea"&&l==="value",h=o==="style"&&l==="_cssText";if(h&&r&&typeof u=="string"&&(u=Lt(u,a)),(d||h)&&typeof u=="string"){s.appendChild(i.createTextNode(u)),e.childNodes=[];continue}try{if(e.isSVG&&l==="xlink:href")s.setAttributeNS("http://www.w3.org/1999/xlink",l,u.toString());else if(l==="onload"||l==="onclick"||l.substring(0,7)==="onmouse")s.setAttribute("_"+l,u.toString());else if(o==="meta"&&e.attributes["http-equiv"]==="Content-Security-Policy"&&l==="content"){s.setAttribute("csp-content",u.toString());continue}else o==="link"&&(e.attributes.rel==="preload"||e.attributes.rel==="modulepreload")&&e.attributes.as==="script"||o==="link"&&e.attributes.rel==="prefetch"&&typeof e.attributes.href=="string"&&e.attributes.href.endsWith(".js")||(o==="img"&&e.attributes.srcset&&e.attributes.rr_dataURL?s.setAttribute("rrweb-original-srcset",e.attributes.srcset):s.setAttribute(l,u.toString()))}catch{}}for(const l in c){const u=c[l];if(o==="canvas"&&l==="rr_dataURL"){const d=document.createElement("img");d.onload=()=>{const h=s.getContext("2d");h&&h.drawImage(d,0,0,d.width,d.height)},d.src=u.toString(),s.RRNodeType&&(s.rr_dataURL=u.toString())}else if(o==="img"&&l==="rr_dataURL"){const d=s;d.currentSrc.startsWith("data:")||(d.setAttribute("rrweb-original-src",e.attributes.src),d.src=u.toString())}if(l==="rr_width")s.style.width=u.toString();else if(l==="rr_height")s.style.height=u.toString();else if(l==="rr_mediaCurrentTime"&&typeof u=="number")s.currentTime=u;else if(l==="rr_mediaState")switch(u){case"played":s.play().catch(d=>console.warn("media playback error",d));break;case"paused":s.pause();break}else l==="rr_mediaPlaybackRate"&&typeof u=="number"?s.playbackRate=u:l==="rr_mediaMuted"&&typeof u=="boolean"?s.muted=u:l==="rr_mediaLoop"&&typeof u=="boolean"?s.loop=u:l==="rr_mediaVolume"&&typeof u=="number"&&(s.volume=u)}if(e.isShadowHost)if(!s.shadowRoot)s.attachShadow({mode:"open"});else for(;s.shadowRoot.firstChild;)s.shadowRoot.removeChild(s.shadowRoot.firstChild);return s}case C.Text:return i.createTextNode(e.isStyle&&r?Lt(e.textContent,a):e.textContent);case C.CDATA:return i.createCDATASection(e.textContent);case C.Comment:return i.createComment(e.textContent);default:return null}}function z(e,t){const{doc:n,mirror:i,skipChild:r=!1,hackCss:a=!0,afterAppend:o,cache:s}=t;if(i.has(e.id)){const l=i.getNode(e.id),u=i.getMeta(l);if(we(u,e))return i.getNode(e.id)}let c=xe(e,{doc:n,hackCss:a,cache:s});if(!c)return null;if(e.rootId&&i.getNode(e.rootId)!==n&&i.replace(e.rootId,n),e.type===C.Document&&(n.close(),n.open(),e.compatMode==="BackCompat"&&e.childNodes&&e.childNodes[0].type!==C.DocumentType&&(e.childNodes[0].type===C.Element&&"xmlns"in e.childNodes[0].attributes&&e.childNodes[0].attributes.xmlns==="http://www.w3.org/1999/xhtml"?n.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'):n.write('<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">')),c=n),i.add(c,e),(e.type===C.Document||e.type===C.Element)&&!r)for(const l of e.childNodes){const u=z(l,{doc:n,mirror:i,skipChild:!1,hackCss:a,afterAppend:o,cache:s});if(!u){console.warn("Failed to rebuild",l);continue}if(l.isShadow&&Te(c)&&c.shadowRoot)c.shadowRoot.appendChild(u);else if(e.type===C.Document&&l.type==C.Element){const d=u;let h=null;d.childNodes.forEach(g=>{g.nodeName==="BODY"&&(h=g)}),h?(d.removeChild(h),c.appendChild(u),d.appendChild(h)):c.appendChild(u)}else c.appendChild(u);o&&o(u,l.id)}return c}function Ae(e,t){function n(i){t(i)}for(const i of e.getIds())e.has(i)&&n(e.getNode(i))}function Ie(e,t){const n=t.getMeta(e);if(n?.type!==C.Element)return;const i=e;for(const r in n.attributes){if(!(Object.prototype.hasOwnProperty.call(n.attributes,r)&&r.startsWith("rr_")))continue;const a=n.attributes[r];r==="rr_scrollLeft"&&(i.scrollLeft=a),r==="rr_scrollTop"&&(i.scrollTop=a)}}function Oe(e,t){const{doc:n,onVisit:i,hackCss:r=!0,afterAppend:a,cache:o,mirror:s=new xt}=t,c=z(e,{doc:n,mirror:s,skipChild:!1,hackCss:r,afterAppend:a,cache:o});return Ae(s,l=>{i&&i(l),Ie(l,s)}),c}var b;(function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"})(b||(b={}));class ke{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var n;if(!t)return-1;const i=(n=this.getMeta(t))===null||n===void 0?void 0:n.id;return i??-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){const n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach(i=>this.removeNodeFromMap(i))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,n){const i=n.id;this.idNodeMap.set(i,t),this.nodeMetaMap.set(t,n)}replace(t,n){const i=this.getNode(t);if(i){const r=this.nodeMetaMap.get(i);r&&this.nodeMetaMap.set(n,r)}this.idNodeMap.set(t,n)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function _e(){return new ke}function Le(e){const t={},n=/;(?![^(]*\))/g,i=/:(.+)/,r=/\/\*.*?\*\//g;return e.replace(r,"").split(n).forEach(function(a){if(a){const o=a.split(i);o.length>1&&(t[ht(o[0].trim())]=o[1].trim())}}),t}function Ft(e){const t=[];for(const n in e){const i=e[n];if(typeof i!="string")continue;const r=Be(n);t.push(`${r}: ${i};`)}return t.join(" ")}const Pe=/-([a-z])/g,Fe=/^--[a-zA-Z0-9-]+$/,ht=e=>Fe.test(e)?e:e.replace(Pe,(t,n)=>n?n.toUpperCase():""),$e=/\B([A-Z])/g,Be=e=>e.replace($e,"-$1").toLowerCase();class _{constructor(...t){this.parentElement=null,this.parentNode=null,this.firstChild=null,this.lastChild=null,this.previousSibling=null,this.nextSibling=null,this.ELEMENT_NODE=x.ELEMENT_NODE,this.TEXT_NODE=x.TEXT_NODE}get childNodes(){const t=[];let n=this.firstChild;for(;n;)t.push(n),n=n.nextSibling;return t}contains(t){if(t instanceof _){if(t.ownerDocument!==this.ownerDocument)return!1;if(t===this)return!0}else return!1;for(;t.parentNode;){if(t.parentNode===this)return!0;t=t.parentNode}return!1}appendChild(t){throw new Error("RRDomException: Failed to execute 'appendChild' on 'RRNode': This RRNode type does not support this method.")}insertBefore(t,n){throw new Error("RRDomException: Failed to execute 'insertBefore' on 'RRNode': This RRNode type does not support this method.")}removeChild(t){throw new Error("RRDomException: Failed to execute 'removeChild' on 'RRNode': This RRNode type does not support this method.")}toString(){return"RRNode"}}function Ue(e){return class Ne extends e{constructor(...n){super(n),this.nodeType=x.DOCUMENT_NODE,this.nodeName="#document",this.compatMode="CSS1Compat",this.RRNodeType=b.Document,this.textContent=null,this.ownerDocument=this}get documentElement(){return this.childNodes.find(n=>n.RRNodeType===b.Element&&n.tagName==="HTML")||null}get body(){var n;return((n=this.documentElement)===null||n===void 0?void 0:n.childNodes.find(i=>i.RRNodeType===b.Element&&i.tagName==="BODY"))||null}get head(){var n;return((n=this.documentElement)===null||n===void 0?void 0:n.childNodes.find(i=>i.RRNodeType===b.Element&&i.tagName==="HEAD"))||null}get implementation(){return this}get firstElementChild(){return this.documentElement}appendChild(n){const i=n.RRNodeType;if((i===b.Element||i===b.DocumentType)&&this.childNodes.some(a=>a.RRNodeType===i))throw new Error(`RRDomException: Failed to execute 'appendChild' on 'RRNode': Only one ${i===b.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);const r=mt(this,n);return r.parentElement=null,r}insertBefore(n,i){const r=n.RRNodeType;if((r===b.Element||r===b.DocumentType)&&this.childNodes.some(o=>o.RRNodeType===r))throw new Error(`RRDomException: Failed to execute 'insertBefore' on 'RRNode': Only one ${r===b.Element?"RRElement":"RRDoctype"} on RRDocument allowed.`);const a=jt(this,n,i);return a.parentElement=null,a}removeChild(n){return Gt(this,n)}open(){this.firstChild=null,this.lastChild=null}close(){}write(n){let i;if(n==='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'?i="-//W3C//DTD XHTML 1.0 Transitional//EN":n==='<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">'&&(i="-//W3C//DTD HTML 4.0 Transitional//EN"),i){const r=this.createDocumentType("html",i,"");this.open(),this.appendChild(r)}}createDocument(n,i,r){return new Ne}createDocumentType(n,i,r){const a=new($t(_))(n,i,r);return a.ownerDocument=this,a}createElement(n){const i=new(Bt(_))(n);return i.ownerDocument=this,i}createElementNS(n,i){return this.createElement(i)}createTextNode(n){const i=new(Ut(_))(n);return i.ownerDocument=this,i}createComment(n){const i=new(Vt(_))(n);return i.ownerDocument=this,i}createCDATASection(n){const i=new(Wt(_))(n);return i.ownerDocument=this,i}toString(){return"RRDocument"}}}function $t(e){return class extends e{constructor(t,n,i){super(),this.nodeType=x.DOCUMENT_TYPE_NODE,this.RRNodeType=b.DocumentType,this.name=t,this.publicId=n,this.systemId=i,this.nodeName=t,this.textContent=null}toString(){return"RRDocumentType"}}}function Bt(e){return class extends e{constructor(t){super(),this.nodeType=x.ELEMENT_NODE,this.RRNodeType=b.Element,this.attributes={},this.shadowRoot=null,this.tagName=t.toUpperCase(),this.nodeName=t.toUpperCase()}get textContent(){let t="";return this.childNodes.forEach(n=>t+=n.textContent),t}set textContent(t){this.firstChild=null,this.lastChild=null,this.appendChild(this.ownerDocument.createTextNode(t))}get classList(){return new We(this.attributes.class,t=>{this.attributes.class=t})}get id(){return this.attributes.id||""}get className(){return this.attributes.class||""}get style(){const t=this.attributes.style?Le(this.attributes.style):{},n=/\B([A-Z])/g;return t.setProperty=(i,r,a)=>{if(n.test(i))return;const o=ht(i);r?t[o]=r:delete t[o],a==="important"&&(t[o]+=" !important"),this.attributes.style=Ft(t)},t.removeProperty=i=>{if(n.test(i))return"";const r=ht(i),a=t[r]||"";return delete t[r],this.attributes.style=Ft(t),a},t}getAttribute(t){return this.attributes[t]||null}setAttribute(t,n){this.attributes[t]=n}setAttributeNS(t,n,i){this.setAttribute(n,i)}removeAttribute(t){delete this.attributes[t]}appendChild(t){return mt(this,t)}insertBefore(t,n){return jt(this,t,n)}removeChild(t){return Gt(this,t)}attachShadow(t){const n=this.ownerDocument.createElement("SHADOWROOT");return this.shadowRoot=n,n}dispatchEvent(t){return!0}toString(){let t="";for(const n in this.attributes)t+=`${n}="${this.attributes[n]}" `;return`${this.tagName} ${t}`}}}function Ve(e){return class extends e{attachShadow(t){throw new Error("RRDomException: Failed to execute 'attachShadow' on 'RRElement': This RRElement does not support attachShadow")}play(){this.paused=!1}pause(){this.paused=!0}}}function Ut(e){return class extends e{constructor(t){super(),this.nodeType=x.TEXT_NODE,this.nodeName="#text",this.RRNodeType=b.Text,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRText text=${JSON.stringify(this.data)}`}}}function Vt(e){return class extends e{constructor(t){super(),this.nodeType=x.COMMENT_NODE,this.nodeName="#comment",this.RRNodeType=b.Comment,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRComment text=${JSON.stringify(this.data)}`}}}function Wt(e){return class extends e{constructor(t){super(),this.nodeName="#cdata-section",this.nodeType=x.CDATA_SECTION_NODE,this.RRNodeType=b.CDATA,this.data=t}get textContent(){return this.data}set textContent(t){this.data=t}toString(){return`RRCDATASection data=${JSON.stringify(this.data)}`}}}class We{constructor(t,n){if(this.classes=[],this.add=(...i)=>{for(const r of i){const a=String(r);this.classes.indexOf(a)>=0||this.classes.push(a)}this.onChange&&this.onChange(this.classes.join(" "))},this.remove=(...i)=>{this.classes=this.classes.filter(r=>i.indexOf(r)===-1),this.onChange&&this.onChange(this.classes.join(" "))},t){const i=t.trim().split(/\s+/);this.classes.push(...i)}this.onChange=n}}function mt(e,t){return t.parentNode&&t.parentNode.removeChild(t),e.lastChild?(e.lastChild.nextSibling=t,t.previousSibling=e.lastChild):(e.firstChild=t,t.previousSibling=null),e.lastChild=t,t.nextSibling=null,t.parentNode=e,t.parentElement=e,t.ownerDocument=e.ownerDocument,t}function jt(e,t,n){if(!n)return mt(e,t);if(n.parentNode!==e)throw new Error("Failed to execute 'insertBefore' on 'RRNode': The RRNode before which the new node is to be inserted is not a child of this RRNode.");return t===n||(t.parentNode&&t.parentNode.removeChild(t),t.previousSibling=n.previousSibling,n.previousSibling=t,t.nextSibling=n,t.previousSibling?t.previousSibling.nextSibling=t:e.firstChild=t,t.parentElement=e,t.parentNode=e,t.ownerDocument=e.ownerDocument),t}function Gt(e,t){if(t.parentNode!==e)throw new Error("Failed to execute 'removeChild' on 'RRNode': The RRNode to be removed is not a child of this RRNode.");return t.previousSibling?t.previousSibling.nextSibling=t.nextSibling:e.firstChild=t.nextSibling,t.nextSibling?t.nextSibling.previousSibling=t.previousSibling:e.lastChild=t.previousSibling,t.previousSibling=null,t.nextSibling=null,t.parentElement=null,t.parentNode=null,t}var x;(function(e){e[e.PLACEHOLDER=0]="PLACEHOLDER",e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.ATTRIBUTE_NODE=2]="ATTRIBUTE_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",e[e.ENTITY_REFERENCE_NODE=5]="ENTITY_REFERENCE_NODE",e[e.ENTITY_NODE=6]="ENTITY_NODE",e[e.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE",e[e.DOCUMENT_NODE=9]="DOCUMENT_NODE",e[e.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",e[e.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE"})(x||(x={}));const pt={svg:"http://www.w3.org/2000/svg","xlink:href":"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/2000/xmlns/"},je={altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};let $=null;function tt(e,t,n,i=t.mirror||t.ownerDocument.mirror){e=Ge(e,t,n,i),Yt(e,t,n,i),Ye(e,t,n)}function Ge(e,t,n,i){var r;if(n.afterAppend&&!$&&($=new WeakSet,setTimeout(()=>{$=null},0)),!ft(e,t)){const a=et(t,n.mirror,i);(r=e.parentNode)===null||r===void 0||r.replaceChild(a,e),e=a}switch(t.RRNodeType){case b.Document:{if(!W(e,t,n.mirror,i)){const a=i.getMeta(t);a&&(n.mirror.removeNodeFromMap(e),e.close(),e.open(),n.mirror.add(e,a),$?.add(e))}break}case b.Element:{const a=e,o=t;switch(o.tagName){case"IFRAME":{const s=e.contentDocument;if(!s)break;tt(s,t.contentDocument,n,i);break}}o.shadowRoot&&(a.shadowRoot||a.attachShadow({mode:"open"}),Yt(a.shadowRoot,o.shadowRoot,n,i)),He(a,o,i);break}}return e}function Ye(e,t,n){var i;switch(t.RRNodeType){case b.Document:{const r=t.scrollData;r&&n.applyScroll(r,!0);break}case b.Element:{const r=e,a=t;switch(a.scrollData&&n.applyScroll(a.scrollData,!0),a.inputData&&n.applyInput(a.inputData),a.tagName){case"AUDIO":case"VIDEO":{const o=e,s=a;s.paused!==void 0&&(s.paused?o.pause():o.play()),s.muted!==void 0&&(o.muted=s.muted),s.volume!==void 0&&(o.volume=s.volume),s.currentTime!==void 0&&(o.currentTime=s.currentTime),s.playbackRate!==void 0&&(o.playbackRate=s.playbackRate),s.loop!==void 0&&(o.loop=s.loop);break}case"CANVAS":{const o=t;if(o.rr_dataURL!==null){const s=document.createElement("img");s.onload=()=>{const c=r.getContext("2d");c&&c.drawImage(s,0,0,s.width,s.height)},s.src=o.rr_dataURL}o.canvasMutations.forEach(s=>n.applyCanvas(s.event,s.mutation,e));break}case"STYLE":{const o=r.sheet;o&&t.rules.forEach(s=>n.applyStyleSheetMutation(s,o));break}}break}case b.Text:case b.Comment:case b.CDATA:{e.textContent!==t.data&&(e.textContent=t.data);break}}$!=null&&$.has(e)&&($.delete(e),(i=n.afterAppend)===null||i===void 0||i.call(n,e,n.mirror.getId(e)))}function He(e,t,n){const i=e.attributes,r=t.attributes;for(const a in r){const o=r[a],s=n.getMeta(t);if(s?.isSVG&&pt[a])e.setAttributeNS(pt[a],a,o);else if(t.tagName==="CANVAS"&&a==="rr_dataURL"){const c=document.createElement("img");c.src=o,c.onload=()=>{const l=e.getContext("2d");l&&l.drawImage(c,0,0,c.width,c.height)}}else{if(t.tagName==="IFRAME"&&a==="srcdoc")continue;e.setAttribute(a,o)}}for(const{name:a}of Array.from(i))a in r||e.removeAttribute(a);t.scrollLeft&&(e.scrollLeft=t.scrollLeft),t.scrollTop&&(e.scrollTop=t.scrollTop)}function Yt(e,t,n,i){const r=Array.from(e.childNodes),a=t.childNodes;if(r.length===0&&a.length===0)return;let o=0,s=r.length-1,c=0,l=a.length-1,u=r[o],d=r[s],h=a[c],g=a[l],v,N;for(;o<=s&&c<=l;)if(u===void 0)u=r[++o];else if(d===void 0)d=r[--s];else if(W(u,h,n.mirror,i))u=r[++o],h=a[++c];else if(W(d,g,n.mirror,i))d=r[--s],g=a[--l];else if(W(u,g,n.mirror,i)){try{e.insertBefore(u,d.nextSibling)}catch(E){console.warn(E)}u=r[++o],g=a[--l]}else if(W(d,h,n.mirror,i)){try{e.insertBefore(d,u)}catch(E){console.warn(E)}d=r[--s],h=a[++c]}else{if(!v){v={};for(let y=o;y<=s;y++){const M=r[y];M&&n.mirror.hasNode(M)&&(v[n.mirror.getId(M)]=y)}}N=v[i.getId(h)];const E=r[N];if(N!==void 0&&E&&W(E,h,n.mirror,i)){try{e.insertBefore(E,u)}catch(y){console.warn(y)}r[N]=void 0}else{const y=et(h,n.mirror,i);e.nodeName==="#document"&&u&&(y.nodeType===y.DOCUMENT_TYPE_NODE&&u.nodeType===u.DOCUMENT_TYPE_NODE||y.nodeType===y.ELEMENT_NODE&&u.nodeType===u.ELEMENT_NODE)&&(e.removeChild(u),n.mirror.removeNodeFromMap(u),u=r[++o]);try{e.insertBefore(y,u||null)}catch(M){console.warn(M)}}h=a[++c]}if(o>s){const E=a[l+1];let y=null;for(E&&(y=n.mirror.getNode(i.getId(E)));c<=l;++c){const M=et(a[c],n.mirror,i);try{e.insertBefore(M,y)}catch(A){console.warn(A)}}}else if(c>l)for(;o<=s;o++){const E=r[o];if(!(!E||E.parentNode!==e))try{e.removeChild(E),n.mirror.removeNodeFromMap(E)}catch(y){console.warn(y)}}let S=e.firstChild,m=t.firstChild;for(;S!==null&&m!==null;)tt(S,m,n,i),S=S.nextSibling,m=m.nextSibling}function et(e,t,n){const i=n.getId(e),r=n.getMeta(e);let a=null;if(i>-1&&(a=t.getNode(i)),a!==null&&ft(a,e))return a;switch(e.RRNodeType){case b.Document:a=new Document;break;case b.DocumentType:a=document.implementation.createDocumentType(e.name,e.publicId,e.systemId);break;case b.Element:{let o=e.tagName.toLowerCase();o=je[o]||o,r&&"isSVG"in r&&r?.isSVG?a=document.createElementNS(pt.svg,o):a=document.createElement(e.tagName);break}case b.Text:a=document.createTextNode(e.data);break;case b.Comment:a=document.createComment(e.data);break;case b.CDATA:a=document.createCDATASection(e.data);break}r&&t.add(a,Object.assign({},r));try{$?.add(a)}catch{}return a}function ft(e,t){return e.nodeType!==t.nodeType?!1:e.nodeType!==e.ELEMENT_NODE||e.tagName.toUpperCase()===t.tagName}function W(e,t,n,i){const r=n.getId(e),a=i.getId(t);return r===-1||r!==a?!1:ft(e,t)}class j extends Ue(_){get unserializedId(){return this._unserializedId--}constructor(t){super(),this.UNSERIALIZED_STARTING_ID=-2,this._unserializedId=this.UNSERIALIZED_STARTING_ID,this.mirror=sn(),this.scrollData=null,t&&(this.mirror=t)}createDocument(t,n,i){return new j}createDocumentType(t,n,i){const r=new ze(t,n,i);return r.ownerDocument=this,r}createElement(t){const n=t.toUpperCase();let i;switch(n){case"AUDIO":case"VIDEO":i=new Xe(n);break;case"IFRAME":i=new Je(n,this.mirror);break;case"CANVAS":i=new Qe(n);break;case"STYLE":i=new qe(n);break;default:i=new X(n);break}return i.ownerDocument=this,i}createComment(t){const n=new Ke(t);return n.ownerDocument=this,n}createCDATASection(t){const n=new tn(t);return n.ownerDocument=this,n}createTextNode(t){const n=new Ze(t);return n.ownerDocument=this,n}destroyTree(){this.firstChild=null,this.lastChild=null,this.mirror.reset()}open(){super.open(),this._unserializedId=this.UNSERIALIZED_STARTING_ID}}const ze=$t(_);class X extends Bt(_){constructor(){super(...arguments),this.inputData=null,this.scrollData=null}}class Xe extends Ve(X){}class Qe extends X{constructor(){super(...arguments),this.rr_dataURL=null,this.canvasMutations=[]}getContext(){return null}}class qe extends X{constructor(){super(...arguments),this.rules=[]}}class Je extends X{constructor(t,n){super(t),this.contentDocument=new j,this.contentDocument.mirror=n}}const Ze=Ut(_),Ke=Vt(_),tn=Wt(_);function en(e){return e instanceof HTMLFormElement?"FORM":e.tagName.toUpperCase()}function Ht(e,t,n,i){let r;switch(e.nodeType){case x.DOCUMENT_NODE:i&&i.nodeName==="IFRAME"?r=i.contentDocument:(r=t,r.compatMode=e.compatMode);break;case x.DOCUMENT_TYPE_NODE:{const o=e;r=t.createDocumentType(o.name,o.publicId,o.systemId);break}case x.ELEMENT_NODE:{const o=e,s=en(o);r=t.createElement(s);const c=r;for(const{name:l,value:u}of Array.from(o.attributes))c.attributes[l]=u;o.scrollLeft&&(c.scrollLeft=o.scrollLeft),o.scrollTop&&(c.scrollTop=o.scrollTop);break}case x.TEXT_NODE:r=t.createTextNode(e.textContent||"");break;case x.CDATA_SECTION_NODE:r=t.createCDATASection(e.data);break;case x.COMMENT_NODE:r=t.createComment(e.textContent||"");break;case x.DOCUMENT_FRAGMENT_NODE:r=i.attachShadow({mode:"open"});break;default:return null}let a=n.getMeta(e);return t instanceof j&&(a||(a=zt(r,t.unserializedId),n.add(e,a)),t.mirror.add(r,Object.assign({},a))),r}function nn(e,t=_e(),n=new j){function i(r,a){const o=Ht(r,n,t,a);if(o!==null)if(a?.nodeName!=="IFRAME"&&r.nodeType!==x.DOCUMENT_FRAGMENT_NODE&&(a?.appendChild(o),o.parentNode=a,o.parentElement=a),r.nodeName==="IFRAME"){const s=r.contentDocument;s&&i(s,o)}else(r.nodeType===x.DOCUMENT_NODE||r.nodeType===x.ELEMENT_NODE||r.nodeType===x.DOCUMENT_FRAGMENT_NODE)&&(r.nodeType===x.ELEMENT_NODE&&r.shadowRoot&&i(r.shadowRoot,o),r.childNodes.forEach(s=>i(s,o)))}return i(e,null),n}function sn(){return new on}class on{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(t){var n;if(!t)return-1;const i=(n=this.getMeta(t))===null||n===void 0?void 0:n.id;return i??-1}getNode(t){return this.idNodeMap.get(t)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(t){return this.nodeMetaMap.get(t)||null}removeNodeFromMap(t){const n=this.getId(t);this.idNodeMap.delete(n),t.childNodes&&t.childNodes.forEach(i=>this.removeNodeFromMap(i))}has(t){return this.idNodeMap.has(t)}hasNode(t){return this.nodeMetaMap.has(t)}add(t,n){const i=n.id;this.idNodeMap.set(i,t),this.nodeMetaMap.set(t,n)}replace(t,n){const i=this.getNode(t);if(i){const r=this.nodeMetaMap.get(i);r&&this.nodeMetaMap.set(n,r)}this.idNodeMap.set(t,n)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function zt(e,t){switch(e.RRNodeType){case b.Document:return{id:t,type:e.RRNodeType,childNodes:[]};case b.DocumentType:{const n=e;return{id:t,type:e.RRNodeType,name:n.name,publicId:n.publicId,systemId:n.systemId}}case b.Element:return{id:t,type:e.RRNodeType,tagName:e.tagName.toLowerCase(),attributes:{},childNodes:[]};case b.Text:return{id:t,type:e.RRNodeType,textContent:e.textContent||""};case b.Comment:return{id:t,type:e.RRNodeType,textContent:e.textContent||""};case b.CDATA:return{id:t,type:e.RRNodeType,textContent:""}}}function Xt(e){return{all:e=e||new Map,on:function(t,n){var i=e.get(t);i?i.push(n):e.set(t,[n])},off:function(t,n){var i=e.get(t);i&&(n?i.splice(i.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var i=e.get(t);i&&i.slice().map(function(r){r(n)}),(i=e.get("*"))&&i.slice().map(function(r){r(t,n)})}}}var rn=Object.freeze({__proto__:null,default:Xt});function an(e=window,t=document){if("scrollBehavior"in t.documentElement.style&&e.__forceSmoothScrollPolyfill__!==!0)return;const n=e.HTMLElement||e.Element,i=468,r={scroll:e.scroll||e.scrollTo,scrollBy:e.scrollBy,elementScroll:n.prototype.scroll||c,scrollIntoView:n.prototype.scrollIntoView},a=e.performance&&e.performance.now?e.performance.now.bind(e.performance):Date.now;function o(m){const E=["MSIE ","Trident/","Edge/"];return new RegExp(E.join("|")).test(m)}const s=o(e.navigator.userAgent)?1:0;function c(m,E){this.scrollLeft=m,this.scrollTop=E}function l(m){return .5*(1-Math.cos(Math.PI*m))}function u(m){if(m===null||typeof m!="object"||m.behavior===void 0||m.behavior==="auto"||m.behavior==="instant")return!0;if(typeof m=="object"&&m.behavior==="smooth")return!1;throw new TypeError("behavior member of ScrollOptions "+m.behavior+" is not a valid value for enumeration ScrollBehavior.")}function d(m,E){if(E==="Y")return m.clientHeight+s<m.scrollHeight;if(E==="X")return m.clientWidth+s<m.scrollWidth}function h(m,E){const y=e.getComputedStyle(m,null)["overflow"+E];return y==="auto"||y==="scroll"}function g(m){const E=d(m,"Y")&&h(m,"Y"),y=d(m,"X")&&h(m,"X");return E||y}function v(m){for(;m!==t.body&&g(m)===!1;)m=m.parentNode||m.host;return m}function N(m){const E=a();let y,M,A,L=(E-m.startTime)/i;L=L>1?1:L,y=l(L),M=m.startX+(m.x-m.startX)*y,A=m.startY+(m.y-m.startY)*y,m.method.call(m.scrollable,M,A),(M!==m.x||A!==m.y)&&e.requestAnimationFrame(N.bind(e,m))}function S(m,E,y){let M,A,L,V;const J=a();m===t.body?(M=e,A=e.scrollX||e.pageXOffset,L=e.scrollY||e.pageYOffset,V=r.scroll):(M=m,A=m.scrollLeft,L=m.scrollTop,V=c),N({scrollable:M,method:V,startTime:J,startX:A,startY:L,x:E,y})}e.scroll=e.scrollTo=function(){if(arguments[0]!==void 0){if(u(arguments[0])===!0){r.scroll.call(e,arguments[0].left!==void 0?arguments[0].left:typeof arguments[0]!="object"?arguments[0]:e.scrollX||e.pageXOffset,arguments[0].top!==void 0?arguments[0].top:arguments[1]!==void 0?arguments[1]:e.scrollY||e.pageYOffset);return}S.call(e,t.body,arguments[0].left!==void 0?~~arguments[0].left:e.scrollX||e.pageXOffset,arguments[0].top!==void 0?~~arguments[0].top:e.scrollY||e.pageYOffset)}},e.scrollBy=function(){if(arguments[0]!==void 0){if(u(arguments[0])){r.scrollBy.call(e,arguments[0].left!==void 0?arguments[0].left:typeof arguments[0]!="object"?arguments[0]:0,arguments[0].top!==void 0?arguments[0].top:arguments[1]!==void 0?arguments[1]:0);return}S.call(e,t.body,~~arguments[0].left+(e.scrollX||e.pageXOffset),~~arguments[0].top+(e.scrollY||e.pageYOffset))}},n.prototype.scroll=n.prototype.scrollTo=function(){if(arguments[0]===void 0)return;if(u(arguments[0])===!0){if(typeof arguments[0]=="number"&&arguments[1]===void 0)throw new SyntaxError("Value could not be converted");r.elementScroll.call(this,arguments[0].left!==void 0?~~arguments[0].left:typeof arguments[0]!="object"?~~arguments[0]:this.scrollLeft,arguments[0].top!==void 0?~~arguments[0].top:arguments[1]!==void 0?~~arguments[1]:this.scrollTop);return}const m=arguments[0].left,E=arguments[0].top;S.call(this,this,typeof m>"u"?this.scrollLeft:~~m,typeof E>"u"?this.scrollTop:~~E)},n.prototype.scrollBy=function(){if(arguments[0]!==void 0){if(u(arguments[0])===!0){r.elementScroll.call(this,arguments[0].left!==void 0?~~arguments[0].left+this.scrollLeft:~~arguments[0]+this.scrollLeft,arguments[0].top!==void 0?~~arguments[0].top+this.scrollTop:~~arguments[1]+this.scrollTop);return}this.scroll({left:~~arguments[0].left+this.scrollLeft,top:~~arguments[0].top+this.scrollTop,behavior:arguments[0].behavior})}},n.prototype.scrollIntoView=function(){if(u(arguments[0])===!0){r.scrollIntoView.call(this,arguments[0]===void 0?!0:arguments[0]);return}const m=v(this),E=m.getBoundingClientRect(),y=this.getBoundingClientRect();m!==t.body?(S.call(this,m,m.scrollLeft+y.left-E.left,m.scrollTop+y.top-E.top),e.getComputedStyle(m).position!=="fixed"&&e.scrollBy({left:E.left,top:E.top,behavior:"smooth"})):e.scrollBy({left:y.left,top:y.top,behavior:"smooth"})}}var R=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(R||{}),D=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e[e.CustomElement=16]="CustomElement",e))(D||{}),k=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(k||{}),ln=(e=>(e[e.Mouse=0]="Mouse",e[e.Pen=1]="Pen",e[e.Touch=2]="Touch",e))(ln||{}),nt=(e=>(e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2",e))(nt||{}),gt=(e=>(e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Seeked=2]="Seeked",e[e.VolumeChange=3]="VolumeChange",e[e.RateChange=4]="RateChange",e))(gt||{}),w=(e=>(e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back",e.Destroy="destroy",e))(w||{});class cn{constructor(t=[],n){this.timeOffset=0,this.raf=null,this.actions=t,this.speed=n.speed}addAction(t){const n=this.raf===!0;if(!this.actions.length||this.actions[this.actions.length-1].delay<=t.delay)this.actions.push(t);else{const i=this.findActionIndex(t);this.actions.splice(i,0,t)}n&&(this.raf=requestAnimationFrame(this.rafCheck.bind(this)))}start(){this.timeOffset=0,this.lastTimestamp=performance.now(),this.raf=requestAnimationFrame(this.rafCheck.bind(this))}rafCheck(){const t=performance.now();for(this.timeOffset+=(t-this.lastTimestamp)*this.speed,this.lastTimestamp=t;this.actions.length;){const n=this.actions[0];if(this.timeOffset>=n.delay)this.actions.shift(),n.doAction();else break}this.actions.length>0?this.raf=requestAnimationFrame(this.rafCheck.bind(this)):this.raf=!0}clear(){this.raf&&(this.raf!==!0&&cancelAnimationFrame(this.raf),this.raf=null),this.actions.length=0}setSpeed(t){this.speed=t}isActive(){return this.raf!==null}findActionIndex(t){let n=0,i=this.actions.length-1;for(;n<=i;){const r=Math.floor((n+i)/2);if(this.actions[r].delay<t.delay)n=r+1;else if(this.actions[r].delay>t.delay)i=r-1;else return r+1}return n}}function Qt(e,t){if(e.type===R.IncrementalSnapshot&&e.data.source===D.MouseMove&&e.data.positions&&e.data.positions.length){const n=e.data.positions[0].timeOffset,i=e.timestamp+n;return e.delay=i-t,i-t}return e.delay=e.timestamp-t,e.delay}/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function qt(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var i,r,a=n.call(e),o=[];try{for(;(t===void 0||t-- >0)&&!(i=a.next()).done;)o.push(i.value)}catch(s){r={error:s}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o}var G;(function(e){e[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped"})(G||(G={}));var Jt={type:"xstate.init"};function yt(e){return e===void 0?[]:[].concat(e)}function Y(e){return{type:"xstate.assign",assignment:e}}function Zt(e,t){return typeof(e=typeof e=="string"&&t&&t[e]?t[e]:e)=="string"?{type:e}:typeof e=="function"?{type:e.name,exec:e}:e}function it(e){return function(t){return e===t}}function Kt(e){return typeof e=="string"?{type:e}:e}function te(e,t){return{value:e,context:t,actions:[],changed:!1,matches:it(e)}}function ee(e,t,n){var i=t,r=!1;return[e.filter(function(a){if(a.type==="xstate.assign"){r=!0;var o=Object.assign({},i);return typeof a.assignment=="function"?o=a.assignment(i,n):Object.keys(a.assignment).forEach(function(s){o[s]=typeof a.assignment[s]=="function"?a.assignment[s](i,n):a.assignment[s]}),i=o,!1}return!0}),i,r]}function ne(e,t){t===void 0&&(t={});var n=qt(ee(yt(e.states[e.initial].entry).map(function(o){return Zt(o,t.actions)}),e.context,Jt),2),i=n[0],r=n[1],a={config:e,_options:t,initialState:{value:e.initial,actions:i,context:r,matches:it(e.initial)},transition:function(o,s){var c,l,u=typeof o=="string"?{value:o,context:e.context}:o,d=u.value,h=u.context,g=Kt(s),v=e.states[d];if(v.on){var N=yt(v.on[g.type]);try{for(var S=function(I){var K=typeof Symbol=="function"&&Symbol.iterator,ct=K&&I[K],f=0;if(ct)return ct.call(I);if(I&&typeof I.length=="number")return{next:function(){return I&&f>=I.length&&(I=void 0),{value:I&&I[f++],done:!I}}};throw new TypeError(K?"Object is not iterable.":"Symbol.iterator is not defined.")}(N),m=S.next();!m.done;m=S.next()){var E=m.value;if(E===void 0)return te(d,h);var y=typeof E=="string"?{target:E}:E,M=y.target,A=y.actions,L=A===void 0?[]:A,V=y.cond,J=V===void 0?function(){return!0}:V,wt=M===void 0,Mt=M??d,Dt=e.states[Mt];if(J(h,g)){var Z=qt(ee((wt?yt(L):[].concat(v.exit,L,Dt.entry).filter(function(I){return I})).map(function(I){return Zt(I,a._options.actions)}),h,g),3),at=Z[0],Ct=Z[1],Rt=Z[2],lt=M??d;return{value:lt,context:Ct,actions:at,changed:M!==d||at.length>0||Rt,matches:it(lt)}}}}catch(I){c={error:I}}finally{try{m&&!m.done&&(l=S.return)&&l.call(S)}finally{if(c)throw c.error}}}return te(d,h)}};return a}var ie=function(e,t){return e.actions.forEach(function(n){var i=n.exec;return i&&i(e.context,t)})};function se(e){var t=e.initialState,n=G.NotStarted,i=new Set,r={_machine:e,send:function(a){n===G.Running&&(t=e.transition(t,a),ie(t,Kt(a)),i.forEach(function(o){return o(t)}))},subscribe:function(a){return i.add(a),a(t),{unsubscribe:function(){return i.delete(a)}}},start:function(a){if(a){var o=typeof a=="object"?a:{context:e.config.context,value:a};t={value:o.value,actions:[],context:o.context,matches:it(o.value)}}return n=G.Running,ie(t,Jt),r},stop:function(){return n=G.Stopped,i.clear(),r},get state(){return t},get status(){return n}};return r}var un=Object.defineProperty,dn=Object.defineProperties,hn=Object.getOwnPropertyDescriptors,oe=Object.getOwnPropertySymbols,mn=Object.prototype.hasOwnProperty,pn=Object.prototype.propertyIsEnumerable,re=(e,t,n)=>t in e?un(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,vt=(e,t)=>{for(var n in t||(t={}))mn.call(t,n)&&re(e,n,t[n]);if(oe)for(var n of oe(t))pn.call(t,n)&&re(e,n,t[n]);return e},Et=(e,t)=>dn(e,hn(t));function fn(e,t){for(let n=e.length-1;n>=0;n--){const i=e[n];if(i.type===R.Meta&&i.timestamp<=t)return e.slice(n)}return e}function gn(e,{getCastFn:t,applyEventsSynchronously:n,emitter:i}){const r=ne({id:"player",context:e,initial:"paused",states:{playing:{on:{PAUSE:{target:"paused",actions:["pause"]},CAST_EVENT:{target:"playing",actions:"castEvent"},END:{target:"paused",actions:["resetLastPlayedEvent","pause"]},ADD_EVENT:{target:"playing",actions:["addEvent"]}}},paused:{on:{PLAY:{target:"playing",actions:["recordTimeOffset","play"]},CAST_EVENT:{target:"paused",actions:"castEvent"},TO_LIVE:{target:"live",actions:["startLive"]},ADD_EVENT:{target:"paused",actions:["addEvent"]}}},live:{on:{ADD_EVENT:{target:"live",actions:["addEvent"]},CAST_EVENT:{target:"live",actions:["castEvent"]}}}}},{actions:{castEvent:Y({lastPlayedEvent:(a,o)=>o.type==="CAST_EVENT"?o.payload.event:a.lastPlayedEvent}),recordTimeOffset:Y((a,o)=>{let s=a.timeOffset;return"payload"in o&&"timeOffset"in o.payload&&(s=o.payload.timeOffset),Et(vt({},a),{timeOffset:s,baselineTime:a.events[0].timestamp+s})}),play(a){var o;const{timer:s,events:c,baselineTime:l,lastPlayedEvent:u}=a;s.clear();for(const v of c)Qt(v,l);const d=fn(c,l);let h=u?.timestamp;u?.type===R.IncrementalSnapshot&&u.data.source===D.MouseMove&&(h=u.timestamp+((o=u.data.positions[0])==null?void 0:o.timeOffset)),l<(h||0)&&i.emit(w.PlayBack);const g=new Array;for(const v of d)if(!(h&&h<l&&(v.timestamp<=h||v===u)))if(v.timestamp<l)g.push(v);else{const N=t(v,!1);s.addAction({doAction:()=>{N()},delay:v.delay})}n(g),i.emit(w.Flush),s.start()},pause(a){a.timer.clear()},resetLastPlayedEvent:Y(a=>Et(vt({},a),{lastPlayedEvent:null})),startLive:Y({baselineTime:(a,o)=>(a.timer.start(),o.type==="TO_LIVE"&&o.payload.baselineTime?o.payload.baselineTime:Date.now())}),addEvent:Y((a,o)=>{const{baselineTime:s,timer:c,events:l}=a;if(o.type==="ADD_EVENT"){const{event:u}=o.payload;Qt(u,s);let d=l.length-1;if(!l[d]||l[d].timestamp<=u.timestamp)l.push(u);else{let v=-1,N=0;for(;N<=d;){const S=Math.floor((N+d)/2);l[S].timestamp<=u.timestamp?N=S+1:d=S-1}v===-1&&(v=N),l.splice(v,0,u)}const h=u.timestamp<s,g=t(u,h);h?g():c.isActive()&&c.addAction({doAction:()=>{g()},delay:u.delay})}return Et(vt({},a),{events:l})})}});return se(r)}function yn(e){const t=ne({id:"speed",context:e,initial:"normal",states:{normal:{on:{FAST_FORWARD:{target:"skipping",actions:["recordSpeed","setSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}},skipping:{on:{BACK_TO_NORMAL:{target:"normal",actions:["restoreSpeed"]},SET_SPEED:{target:"normal",actions:["setSpeed"]}}}}},{actions:{setSpeed:(n,i)=>{"payload"in i&&n.timer.setSpeed(i.payload.speed)},recordSpeed:Y({normalSpeed:n=>n.timer.speed}),restoreSpeed:n=>{n.timer.setSpeed(n.normalSpeed)}}});return se(t)}const H=`Please stop import mirror directly. Instead of that,\r
now you can use replayer.getMirror() to access the mirror instance of a replayer,\r
or you can use record.mirror to access the mirror instance during recording.`;let ae={map:{},getId(){return console.error(H),-1},getNode(){return console.error(H),null},removeNodeFromMap(){console.error(H)},has(){return console.error(H),!1},reset(){console.error(H)}};typeof window<"u"&&window.Proxy&&window.Reflect&&(ae=new Proxy(ae,{get(e,t,n){return t==="map"&&console.error(H),Reflect.get(e,t,n)}})),/[1-9][0-9]{12}/.test(Date.now().toString());function vn(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...t)=>{let n=t[0];if(!(0 in t))throw new TypeError("1 argument is required");do if(this===n)return!0;while(n=n&&n.parentNode);return!1})}function En(e){const t={},n=(r,a)=>{const o={value:r,parent:a,children:[]};return t[r.node.id]=o,o},i=[];for(const r of e){const{nextId:a,parentId:o}=r;if(a&&a in t){const s=t[a];if(s.parent){const c=s.parent.children.indexOf(s);s.parent.children.splice(c,0,n(r,s.parent))}else{const c=i.indexOf(s);i.splice(c,0,n(r,null))}continue}if(o in t){const s=t[o];s.children.push(n(r,s));continue}i.push(n(r,null))}return i}function le(e,t){t(e.value);for(let n=e.children.length-1;n>=0;n--)le(e.children[n],t)}function Nt(e,t){return Boolean(e.nodeName==="IFRAME"&&t.getMeta(e))}function ce(e,t){var n,i;const r=(i=(n=e.ownerDocument)==null?void 0:n.defaultView)==null?void 0:i.frameElement;if(!r||r===t)return{x:0,y:0,relativeScale:1,absoluteScale:1};const a=r.getBoundingClientRect(),o=ce(r,t),s=a.height/r.clientHeight;return{x:a.x*o.relativeScale+o.x,y:a.y*o.relativeScale+o.y,relativeScale:s,absoluteScale:o.absoluteScale*s}}function st(e){return Boolean(e?.shadowRoot)}function Q(e,t){const n=e[t[0]];return t.length===1?n:Q(n.cssRules[t[1]].cssRules,t.slice(2))}function ue(e){const t=[...e],n=t.pop();return{positions:t,index:n}}function Nn(e){const t=new Set,n=[];for(let i=e.length;i--;){const r=e[i];t.has(r.id)||(n.push(r),t.add(r.id))}return n}class Tn{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(t){var n;return(n=this.styleIDMap.get(t))!=null?n:-1}has(t){return this.styleIDMap.has(t)}add(t,n){if(this.has(t))return this.getId(t);let i;return n===void 0?i=this.id++:i=n,this.styleIDMap.set(t,i),this.idStyleMap.set(i,t),i}getStyle(t){return this.idStyleMap.get(t)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}const bn=e=>[`.${e} { background: currentColor }`,"noscript { display: none !important; }"];for(var de="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",q=typeof Uint8Array>"u"?[]:new Uint8Array(256),ot=0;ot<de.length;ot++)q[de.charCodeAt(ot)]=ot;var Sn=function(e){var t=e.length*.75,n=e.length,i,r=0,a,o,s,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);var l=new ArrayBuffer(t),u=new Uint8Array(l);for(i=0;i<n;i+=4)a=q[e.charCodeAt(i)],o=q[e.charCodeAt(i+1)],s=q[e.charCodeAt(i+2)],c=q[e.charCodeAt(i+3)],u[r++]=a<<2|o>>4,u[r++]=(o&15)<<4|s>>2,u[r++]=(s&3)<<6|c&63;return l},wn=(e,t,n)=>new Promise((i,r)=>{var a=c=>{try{s(n.next(c))}catch(l){r(l)}},o=c=>{try{s(n.throw(c))}catch(l){r(l)}},s=c=>c.done?i(c.value):Promise.resolve(c.value).then(a,o);s((n=n.apply(e,t)).next())});const he=new Map;function me(e,t){let n=he.get(e);return n||(n=new Map,he.set(e,n)),n.has(t)||n.set(t,[]),n.get(t)}function U(e,t,n){return i=>wn(this,null,function*(){if(i&&typeof i=="object"&&"rr_type"in i)if(n&&(n.isUnchanged=!1),i.rr_type==="ImageBitmap"&&"args"in i){const r=yield U(e,t,n)(i.args);return yield createImageBitmap.apply(null,r)}else if("index"in i){if(n||t===null)return i;const{rr_type:r,index:a}=i;return me(t,r)[a]}else if("args"in i){const{rr_type:r,args:a}=i,o=window[r];return new o(...yield Promise.all(a.map(U(e,t,n))))}else{if("base64"in i)return Sn(i.base64);if("src"in i){const r=e.get(i.src);if(r)return r;{const a=new Image;return a.src=i.src,e.set(i.src,a),a}}else if("data"in i&&i.rr_type==="Blob"){const r=yield Promise.all(i.data.map(U(e,t,n)));return new Blob(r,{type:i.type})}}else if(Array.isArray(i))return yield Promise.all(i.map(U(e,t,n)));return i})}var Mn=(e,t,n)=>new Promise((i,r)=>{var a=c=>{try{s(n.next(c))}catch(l){r(l)}},o=c=>{try{s(n.throw(c))}catch(l){r(l)}},s=c=>c.done?i(c.value):Promise.resolve(c.value).then(a,o);s((n=n.apply(e,t)).next())});function Dn(e,t){try{return t===nt.WebGL?e.getContext("webgl")||e.getContext("experimental-webgl"):e.getContext("webgl2")}catch{return null}}const Cn=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject"];function Rn(e,t){if(!(t!=null&&t.constructor))return;const{name:n}=t.constructor;if(!Cn.includes(n))return;const i=me(e,n);i.includes(t)||i.push(t)}function xn(e){return Mn(this,arguments,function*({mutation:t,target:n,type:i,imageMap:r,errorHandler:a}){try{const o=Dn(n,i);if(!o)return;if(t.setter){o[t.property]=t.args[0];return}const s=o[t.property],c=yield Promise.all(t.args.map(U(r,o))),l=s.apply(o,c);Rn(o,l)}catch(o){a(t,o)}})}var pe=(e,t,n)=>new Promise((i,r)=>{var a=c=>{try{s(n.next(c))}catch(l){r(l)}},o=c=>{try{s(n.throw(c))}catch(l){r(l)}},s=c=>c.done?i(c.value):Promise.resolve(c.value).then(a,o);s((n=n.apply(e,t)).next())});function An(e){return pe(this,arguments,function*({event:t,mutations:n,target:i,imageMap:r,errorHandler:a}){const o=i.getContext("2d");if(!o){a(n[0],new Error("Canvas context is null"));return}const s=n.map(c=>pe(this,null,function*(){return Promise.all(c.args.map(U(r,o)))}));(yield Promise.all(s)).forEach((c,l)=>{const u=n[l];try{if(u.setter){o[u.property]=u.args[0];return}const d=o[u.property];u.property==="drawImage"&&typeof u.args[0]=="string"?(r.get(t),d.apply(o,u.args)):d.apply(o,c)}catch(d){a(u,d)}})})}var In=(e,t,n)=>new Promise((i,r)=>{var a=c=>{try{s(n.next(c))}catch(l){r(l)}},o=c=>{try{s(n.throw(c))}catch(l){r(l)}},s=c=>c.done?i(c.value):Promise.resolve(c.value).then(a,o);s((n=n.apply(e,t)).next())});function fe(e){return In(this,arguments,function*({event:t,mutation:n,target:i,imageMap:r,canvasEventMap:a,errorHandler:o}){try{const s=a.get(t)||n,c="commands"in s?s.commands:[s];if([nt.WebGL,nt.WebGL2].includes(n.type)){for(let l=0;l<c.length;l++){const u=c[l];yield xn({mutation:u,type:n.type,target:i,imageMap:r,errorHandler:o})}return}yield An({event:t,mutations:c,target:i,imageMap:r,errorHandler:o})}catch(s){o(n,s)}})}class On{constructor(t){this.mediaMap=new Map,this.metadataCallbackMap=new Map,this.warn=t.warn,this.service=t.service,this.speedService=t.speedService,this.emitter=t.emitter,this.getCurrentTime=t.getCurrentTime,this.emitter.on(w.Start,this.start.bind(this)),this.emitter.on(w.SkipStart,this.start.bind(this)),this.emitter.on(w.Pause,this.pause.bind(this)),this.emitter.on(w.Finish,this.pause.bind(this)),this.speedService.subscribe(()=>{this.syncAllMediaElements()})}syncAllMediaElements(t={pause:!1}){this.mediaMap.forEach((n,i)=>{this.syncTargetWithState(i),t.pause&&i.pause()})}start(){this.syncAllMediaElements()}pause(){this.syncAllMediaElements({pause:!0})}seekTo({time:t,target:n,mediaState:i}){if(i.isPlaying){const r=(t-i.lastInteractionTimeOffset)/1e3*i.playbackRate,a="duration"in n&&n.duration;if(Number.isNaN(a)){this.waitForMetadata(n);return}let o=i.currentTimeAtLastInteraction+r;n.loop&&a!==!1&&(o=o%a),n.currentTime=o}else n.pause(),n.currentTime=i.currentTimeAtLastInteraction}waitForMetadata(t){if(this.metadataCallbackMap.has(t)||!("addEventListener"in t))return;const n=()=>{this.metadataCallbackMap.delete(t);const i=this.mediaMap.get(t);!i||this.seekTo({time:this.getCurrentTime(),target:t,mediaState:i})};this.metadataCallbackMap.set(t,n),t.addEventListener("loadedmetadata",n,{once:!0})}getMediaStateFromMutation({target:t,timeOffset:n,mutation:i}){var r,a,o,s,c;const l=this.mediaMap.get(t),{type:u,playbackRate:d,currentTime:h,muted:g,volume:v,loop:N}=i;return{isPlaying:u===gt.Play||u!==gt.Pause&&(l?.isPlaying||t.getAttribute("autoplay")!==null),currentTimeAtLastInteraction:(r=h??l?.currentTimeAtLastInteraction)!=null?r:0,lastInteractionTimeOffset:n,playbackRate:(a=d??l?.playbackRate)!=null?a:1,volume:(o=v??l?.volume)!=null?o:1,muted:(s=g??l?.muted)!=null?s:t.getAttribute("muted")===null,loop:(c=N??l?.loop)!=null?c:t.getAttribute("loop")===null}}syncTargetWithState(t){const n=this.mediaMap.get(t);if(!n)return;const{muted:i,loop:r,volume:a,isPlaying:o}=n,s=this.service.state.matches("paused"),c=n.playbackRate*this.speedService.state.context.timer.speed;try{this.seekTo({time:this.getCurrentTime(),target:t,mediaState:n}),t.volume!==a&&(t.volume=a),t.muted=i,t.loop=r,t.playbackRate!==c&&(t.playbackRate=c),o&&!s?t.play():t.pause()}catch(l){this.warn(`Failed to replay media interactions: ${l.message||l}`)}}addMediaElements(t,n,i){if(!["AUDIO","VIDEO"].includes(t.nodeName))return;const r=t,a=i.getMeta(r);if(!a||!("attributes"in a))return;const o=this.service.state.matches("paused"),s=a.attributes;let c=!1;s.rr_mediaState?c=s.rr_mediaState==="played":c=r.getAttribute("autoplay")!==null,c&&o&&r.pause();let l=1;typeof s.rr_mediaPlaybackRate=="number"&&(l=s.rr_mediaPlaybackRate);let u=!1;typeof s.rr_mediaMuted=="boolean"?u=s.rr_mediaMuted:u=r.getAttribute("muted")!==null;let d=!1;typeof s.rr_mediaLoop=="boolean"?d=s.rr_mediaLoop:d=r.getAttribute("loop")!==null;let h=1;typeof s.rr_mediaVolume=="number"&&(h=s.rr_mediaVolume);let g=0;typeof s.rr_mediaCurrentTime=="number"&&(g=s.rr_mediaCurrentTime),this.mediaMap.set(r,{isPlaying:c,currentTimeAtLastInteraction:g,lastInteractionTimeOffset:n,playbackRate:l,volume:h,muted:u,loop:d}),this.syncTargetWithState(r)}mediaMutation({target:t,timeOffset:n,mutation:i}){this.mediaMap.set(t,this.getMediaStateFromMutation({target:t,timeOffset:n,mutation:i})),this.syncTargetWithState(t)}isSupportedMediaElement(t){return["AUDIO","VIDEO"].includes(t.nodeName)}reset(){this.mediaMap.clear()}}var kn=Object.defineProperty,_n=Object.defineProperties,Ln=Object.getOwnPropertyDescriptors,ge=Object.getOwnPropertySymbols,Pn=Object.prototype.hasOwnProperty,Fn=Object.prototype.propertyIsEnumerable,ye=(e,t,n)=>t in e?kn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,rt=(e,t)=>{for(var n in t||(t={}))Pn.call(t,n)&&ye(e,n,t[n]);if(ge)for(var n of ge(t))Fn.call(t,n)&&ye(e,n,t[n]);return e},Tt=(e,t)=>_n(e,Ln(t)),bt=(e,t,n)=>new Promise((i,r)=>{var a=c=>{try{s(n.next(c))}catch(l){r(l)}},o=c=>{try{s(n.throw(c))}catch(l){r(l)}},s=c=>c.done?i(c.value):Promise.resolve(c.value).then(a,o);s((n=n.apply(e,t)).next())});const $n=5*1e3,Bn=Xt||rn,ve="[replayer]",St={duration:500,lineCap:"round",lineWidth:3,strokeStyle:"red"};function Ee(e){return e.type==R.IncrementalSnapshot&&(e.data.source==D.TouchMove||e.data.source==D.MouseInteraction&&e.data.type==k.TouchStart)}class Un{constructor(t,n){if(this.usingVirtualDom=!1,this.virtualDom=new j,this.mouseTail=null,this.tailPositions=[],this.emitter=Bn(),this.legacy_missingNodeRetryMap={},this.cache=Pt(),this.imageMap=new Map,this.canvasEventMap=new Map,this.mirror=be(),this.styleMirror=new Tn,this.firstFullSnapshot=null,this.newDocumentQueue=[],this.mousePos=null,this.touchActive=null,this.lastMouseDownEvent=null,this.lastSelectionData=null,this.constructedStyleMutations=[],this.adoptedStyleSheets=[],this.handleResize=s=>{this.iframe.style.display="inherit";for(const c of[this.mouseTail,this.iframe])!c||(c.setAttribute("width",String(s.width)),c.setAttribute("height",String(s.height)))},this.applyEventsSynchronously=s=>{for(const c of s){switch(c.type){case R.DomContentLoaded:case R.Load:case R.Custom:continue;case R.FullSnapshot:case R.Meta:case R.Plugin:case R.IncrementalSnapshot:break}this.getCastFn(c,!0)()}},this.getCastFn=(s,c=!1)=>{let l;switch(s.type){case R.DomContentLoaded:case R.Load:break;case R.Custom:l=()=>{this.emitter.emit(w.CustomEvent,s)};break;case R.Meta:l=()=>this.emitter.emit(w.Resize,{width:s.data.width,height:s.data.height});break;case R.FullSnapshot:l=()=>{var u;if(this.firstFullSnapshot){if(this.firstFullSnapshot===s){this.firstFullSnapshot=!0;return}}else this.firstFullSnapshot=!0;this.mediaManager.reset(),this.styleMirror.reset(),this.rebuildFullSnapshot(s,c),(u=this.iframe.contentWindow)==null||u.scrollTo(s.data.initialOffset)};break;case R.IncrementalSnapshot:l=()=>{if(this.applyIncremental(s,c),!c&&(s===this.nextUserInteractionEvent&&(this.nextUserInteractionEvent=null,this.backToNormal()),this.config.skipInactive&&!this.nextUserInteractionEvent)){for(const u of this.service.state.context.events)if(!(u.timestamp<=s.timestamp)&&this.isUserInteraction(u)){u.delay-s.delay>this.config.inactivePeriodThreshold*this.speedService.state.context.timer.speed&&(this.nextUserInteractionEvent=u);break}if(this.nextUserInteractionEvent){const u=this.nextUserInteractionEvent.delay-s.delay,d={speed:Math.min(Math.round(u/$n),this.config.maxSpeed)};this.speedService.send({type:"FAST_FORWARD",payload:d}),this.emitter.emit(w.SkipStart,d)}}};break}return()=>{l&&l();for(const d of this.config.plugins||[])d.handler&&d.handler(s,c,{replayer:this});this.service.send({type:"CAST_EVENT",payload:{event:s}});const u=this.service.state.context.events.length-1;if(!this.config.liveMode&&s===this.service.state.context.events[u]){const d=()=>{u<this.service.state.context.events.length-1||(this.backToNormal(),this.service.send("END"),this.emitter.emit(w.Finish))};let h=50;s.type===R.IncrementalSnapshot&&s.data.source===D.MouseMove&&s.data.positions.length&&(h+=Math.max(0,-s.data.positions[0].timeOffset)),setTimeout(d,h)}this.emitter.emit(w.EventCast,s)}},!(n!=null&&n.liveMode)&&t.length<2)throw new Error("Replayer need at least 2 events.");const i={speed:1,maxSpeed:360,root:document.body,loadTimeout:0,skipInactive:!1,inactivePeriodThreshold:10*1e3,showWarning:!0,showDebug:!1,blockClass:"rr-block",liveMode:!1,insertStyleRules:[],triggerFocus:!0,UNSAFE_replayCanvas:!1,pauseAnimation:!0,mouseTail:St,useVirtualDom:!0,logger:console};this.config=Object.assign({},i,n),this.handleResize=this.handleResize.bind(this),this.getCastFn=this.getCastFn.bind(this),this.applyEventsSynchronously=this.applyEventsSynchronously.bind(this),this.emitter.on(w.Resize,this.handleResize),this.setupDom();for(const s of this.config.plugins||[])s.getMirror&&s.getMirror({nodeMirror:this.mirror});this.emitter.on(w.Flush,()=>{if(this.usingVirtualDom){const s={mirror:this.mirror,applyCanvas:(c,l,u)=>{fe({event:c,mutation:l,target:u,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})},applyInput:this.applyInput.bind(this),applyScroll:this.applyScroll.bind(this),applyStyleSheetMutation:(c,l)=>{c.source===D.StyleSheetRule?this.applyStyleSheetRule(c,l):c.source===D.StyleDeclaration&&this.applyStyleDeclaration(c,l)},afterAppend:(c,l)=>{for(const u of this.config.plugins||[])u.onBuild&&u.onBuild(c,{id:l,replayer:this})}};if(this.iframe.contentDocument)try{tt(this.iframe.contentDocument,this.virtualDom,s,this.virtualDom.mirror)}catch(c){console.warn(c)}if(this.virtualDom.destroyTree(),this.usingVirtualDom=!1,Object.keys(this.legacy_missingNodeRetryMap).length)for(const c in this.legacy_missingNodeRetryMap)try{const l=this.legacy_missingNodeRetryMap[c],u=et(l.node,this.mirror,this.virtualDom.mirror);tt(u,l.node,s,this.virtualDom.mirror),l.node=u}catch(l){this.warn(l)}this.constructedStyleMutations.forEach(c=>{this.applyStyleSheetMutation(c)}),this.constructedStyleMutations=[],this.adoptedStyleSheets.forEach(c=>{this.applyAdoptedStyleSheet(c)}),this.adoptedStyleSheets=[]}if(this.mousePos&&(this.moveAndHover(this.mousePos.x,this.mousePos.y,this.mousePos.id,!0,this.mousePos.debugData),this.mousePos=null),this.touchActive===!0?this.mouse.classList.add("touch-active"):this.touchActive===!1&&this.mouse.classList.remove("touch-active"),this.touchActive=null,this.lastMouseDownEvent){const[s,c]=this.lastMouseDownEvent;s.dispatchEvent(c)}this.lastMouseDownEvent=null,this.lastSelectionData&&(this.applySelection(this.lastSelectionData),this.lastSelectionData=null)}),this.emitter.on(w.PlayBack,()=>{this.firstFullSnapshot=null,this.mirror.reset(),this.styleMirror.reset(),this.mediaManager.reset()});const r=new cn([],{speed:this.config.speed});this.service=gn({events:t.map(s=>n&&n.unpackFn?n.unpackFn(s):s).sort((s,c)=>s.timestamp-c.timestamp),timer:r,timeOffset:0,baselineTime:0,lastPlayedEvent:null},{getCastFn:this.getCastFn,applyEventsSynchronously:this.applyEventsSynchronously,emitter:this.emitter}),this.service.start(),this.service.subscribe(s=>{this.emitter.emit(w.StateChange,{player:s})}),this.speedService=yn({normalSpeed:-1,timer:r}),this.speedService.start(),this.speedService.subscribe(s=>{this.emitter.emit(w.StateChange,{speed:s})}),this.mediaManager=new On({warn:this.warn.bind(this),service:this.service,speedService:this.speedService,emitter:this.emitter,getCurrentTime:this.getCurrentTime.bind(this)});const a=this.service.state.context.events.find(s=>s.type===R.Meta),o=this.service.state.context.events.find(s=>s.type===R.FullSnapshot);if(a){const{width:s,height:c}=a.data;setTimeout(()=>{this.emitter.emit(w.Resize,{width:s,height:c})},0)}o&&setTimeout(()=>{var s;this.firstFullSnapshot||(this.firstFullSnapshot=o,this.rebuildFullSnapshot(o),(s=this.iframe.contentWindow)==null||s.scrollTo(o.data.initialOffset))},1),this.service.state.context.events.find(Ee)&&this.mouse.classList.add("touch-device")}get timer(){return this.service.state.context.timer}on(t,n){return this.emitter.on(t,n),this}off(t,n){return this.emitter.off(t,n),this}setConfig(t){Object.keys(t).forEach(n=>{t[n],this.config[n]=t[n]}),this.config.skipInactive||this.backToNormal(),typeof t.speed<"u"&&this.speedService.send({type:"SET_SPEED",payload:{speed:t.speed}}),typeof t.mouseTail<"u"&&(t.mouseTail===!1?this.mouseTail&&(this.mouseTail.style.display="none"):(this.mouseTail||(this.mouseTail=document.createElement("canvas"),this.mouseTail.width=Number.parseFloat(this.iframe.width),this.mouseTail.height=Number.parseFloat(this.iframe.height),this.mouseTail.classList.add("replayer-mouse-tail"),this.wrapper.insertBefore(this.mouseTail,this.iframe)),this.mouseTail.style.display="inherit"))}getMetaData(){const t=this.service.state.context.events[0],n=this.service.state.context.events[this.service.state.context.events.length-1];return{startTime:t.timestamp,endTime:n.timestamp,totalTime:n.timestamp-t.timestamp}}getCurrentTime(){return this.timer.timeOffset+this.getTimeOffset()}getTimeOffset(){const{baselineTime:t,events:n}=this.service.state.context;return t-n[0].timestamp}getMirror(){return this.mirror}play(t=0){var n,i;this.service.state.matches("paused")?this.service.send({type:"PLAY",payload:{timeOffset:t}}):(this.service.send({type:"PAUSE"}),this.service.send({type:"PLAY",payload:{timeOffset:t}})),(i=(n=this.iframe.contentDocument)==null?void 0:n.getElementsByTagName("html")[0])==null||i.classList.remove("rrweb-paused"),this.emitter.emit(w.Start)}pause(t){var n,i;t===void 0&&this.service.state.matches("playing")&&this.service.send({type:"PAUSE"}),typeof t=="number"&&(this.play(t),this.service.send({type:"PAUSE"})),(i=(n=this.iframe.contentDocument)==null?void 0:n.getElementsByTagName("html")[0])==null||i.classList.add("rrweb-paused"),this.emitter.emit(w.Pause)}resume(t=0){this.warn("The 'resume' was deprecated in 1.0. Please use 'play' method which has the same interface."),this.play(t),this.emitter.emit(w.Resume)}destroy(){this.pause(),this.mirror.reset(),this.styleMirror.reset(),this.mediaManager.reset(),this.config.root.removeChild(this.wrapper),this.emitter.emit(w.Destroy)}startLive(t){this.service.send({type:"TO_LIVE",payload:{baselineTime:t}})}addEvent(t){const n=this.config.unpackFn?this.config.unpackFn(t):t;Ee(n)&&this.mouse.classList.add("touch-device"),Promise.resolve().then(()=>this.service.send({type:"ADD_EVENT",payload:{event:n}}))}enableInteract(){this.iframe.setAttribute("scrolling","auto"),this.iframe.style.pointerEvents="auto"}disableInteract(){this.iframe.setAttribute("scrolling","no"),this.iframe.style.pointerEvents="none"}resetCache(){this.cache=Pt()}setupDom(){this.wrapper=document.createElement("div"),this.wrapper.classList.add("replayer-wrapper"),this.config.root.appendChild(this.wrapper),this.mouse=document.createElement("div"),this.mouse.classList.add("replayer-mouse"),this.wrapper.appendChild(this.mouse),this.config.mouseTail!==!1&&(this.mouseTail=document.createElement("canvas"),this.mouseTail.classList.add("replayer-mouse-tail"),this.mouseTail.style.display="inherit",this.wrapper.appendChild(this.mouseTail)),this.iframe=document.createElement("iframe");const t=["allow-same-origin"];this.config.UNSAFE_replayCanvas&&t.push("allow-scripts"),this.iframe.style.display="none",this.iframe.setAttribute("sandbox",t.join(" ")),this.disableInteract(),this.wrapper.appendChild(this.iframe),this.iframe.contentWindow&&this.iframe.contentDocument&&(an(this.iframe.contentWindow,this.iframe.contentDocument),vn(this.iframe.contentWindow))}rebuildFullSnapshot(t,n=!1){if(!this.iframe.contentDocument)return this.warn("Looks like your replayer has been destroyed.");Object.keys(this.legacy_missingNodeRetryMap).length&&this.warn("Found unresolved missing node map",this.legacy_missingNodeRetryMap),this.legacy_missingNodeRetryMap={};const i=[],r=(s,c)=>{if(this.collectIframeAndAttachDocument(i,s),this.mediaManager.isSupportedMediaElement(s)){const{events:l}=this.service.state.context;this.mediaManager.addMediaElements(s,t.timestamp-l[0].timestamp,this.mirror)}for(const l of this.config.plugins||[])l.onBuild&&l.onBuild(s,{id:c,replayer:this})};this.usingVirtualDom&&(this.virtualDom.destroyTree(),this.usingVirtualDom=!1),this.mirror.reset(),Oe(t.data.node,{doc:this.iframe.contentDocument,afterAppend:r,cache:this.cache,mirror:this.mirror}),r(this.iframe.contentDocument,t.data.node.id);for(const{mutationInQueue:s,builtNode:c}of i)this.attachDocumentToIframe(s,c),this.newDocumentQueue=this.newDocumentQueue.filter(l=>l!==s);const{documentElement:a,head:o}=this.iframe.contentDocument;this.insertStyleRules(a,o),this.service.state.matches("playing")||this.iframe.contentDocument.getElementsByTagName("html")[0].classList.add("rrweb-paused"),this.emitter.emit(w.FullsnapshotRebuilded,t),n||this.waitForStylesheetLoad(),this.config.UNSAFE_replayCanvas&&this.preloadAllImages()}insertStyleRules(t,n){var i;const r=bn(this.config.blockClass).concat(this.config.insertStyleRules);if(this.config.pauseAnimation&&r.push("html.rrweb-paused *, html.rrweb-paused *:before, html.rrweb-paused *:after { animation-play-state: paused !important; }"),this.usingVirtualDom){const a=this.virtualDom.createElement("style");this.virtualDom.mirror.add(a,zt(a,this.virtualDom.unserializedId)),t.insertBefore(a,n),a.rules.push({source:D.StyleSheetRule,adds:r.map((o,s)=>({rule:o,index:s}))})}else{const a=document.createElement("style");t.insertBefore(a,n);for(let o=0;o<r.length;o++)(i=a.sheet)==null||i.insertRule(r[o],o)}}attachDocumentToIframe(t,n){const i=this.usingVirtualDom?this.virtualDom.mirror:this.mirror,r=[],a=(o,s)=>{this.collectIframeAndAttachDocument(r,o);const c=i.getMeta(o);if(c?.type===C.Element&&c?.tagName.toUpperCase()==="HTML"){const{documentElement:l,head:u}=n.contentDocument;this.insertStyleRules(l,u)}if(!this.usingVirtualDom)for(const l of this.config.plugins||[])l.onBuild&&l.onBuild(o,{id:s,replayer:this})};z(t.node,{doc:n.contentDocument,mirror:i,hackCss:!0,skipChild:!1,afterAppend:a,cache:this.cache}),a(n.contentDocument,t.node.id);for(const{mutationInQueue:o,builtNode:s}of r)this.attachDocumentToIframe(o,s),this.newDocumentQueue=this.newDocumentQueue.filter(c=>c!==o)}collectIframeAndAttachDocument(t,n){if(Nt(n,this.mirror)){const i=this.newDocumentQueue.find(r=>r.parentId===this.mirror.getId(n));i&&t.push({mutationInQueue:i,builtNode:n})}}waitForStylesheetLoad(){var t;const n=(t=this.iframe.contentDocument)==null?void 0:t.head;if(n){const i=new Set;let r,a=this.service.state;const o=()=>{a=this.service.state};this.emitter.on(w.Start,o),this.emitter.on(w.Pause,o);const s=()=>{this.emitter.off(w.Start,o),this.emitter.off(w.Pause,o)};n.querySelectorAll('link[rel="stylesheet"]').forEach(c=>{c.sheet||(i.add(c),c.addEventListener("load",()=>{i.delete(c),i.size===0&&r!==-1&&(a.matches("playing")&&this.play(this.getCurrentTime()),this.emitter.emit(w.LoadStylesheetEnd),r&&clearTimeout(r),s())}))}),i.size>0&&(this.service.send({type:"PAUSE"}),this.emitter.emit(w.LoadStylesheetStart),r=setTimeout(()=>{a.matches("playing")&&this.play(this.getCurrentTime()),r=-1,s()},this.config.loadTimeout))}}preloadAllImages(){return bt(this,null,function*(){this.service.state;const t=()=>{this.service.state};this.emitter.on(w.Start,t),this.emitter.on(w.Pause,t);const n=[];for(const i of this.service.state.context.events)i.type===R.IncrementalSnapshot&&i.data.source===D.CanvasMutation&&(n.push(this.deserializeAndPreloadCanvasEvents(i.data,i)),("commands"in i.data?i.data.commands:[i.data]).forEach(r=>{this.preloadImages(r,i)}));return Promise.all(n)})}preloadImages(t,n){if(t.property==="drawImage"&&typeof t.args[0]=="string"&&!this.imageMap.has(n)){const i=document.createElement("canvas"),r=i.getContext("2d"),a=r?.createImageData(i.width,i.height);a?.data,JSON.parse(t.args[0]),r?.putImageData(a,0,0)}}deserializeAndPreloadCanvasEvents(t,n){return bt(this,null,function*(){if(!this.canvasEventMap.has(n)){const i={isUnchanged:!0};if("commands"in t){const r=yield Promise.all(t.commands.map(a=>bt(this,null,function*(){const o=yield Promise.all(a.args.map(U(this.imageMap,null,i)));return Tt(rt({},a),{args:o})})));i.isUnchanged===!1&&this.canvasEventMap.set(n,Tt(rt({},t),{commands:r}))}else{const r=yield Promise.all(t.args.map(U(this.imageMap,null,i)));i.isUnchanged===!1&&this.canvasEventMap.set(n,Tt(rt({},t),{args:r}))}}})}applyIncremental(t,n){var i,r,a;const{data:o}=t;switch(o.source){case D.Mutation:{try{this.applyMutation(o,n)}catch(s){this.warn(`Exception in mutation ${s.message||s}`,o)}break}case D.Drag:case D.TouchMove:case D.MouseMove:if(n){const s=o.positions[o.positions.length-1];this.mousePos={x:s.x,y:s.y,id:s.id,debugData:o}}else o.positions.forEach(s=>{const c={doAction:()=>{this.moveAndHover(s.x,s.y,s.id,n,o)},delay:s.timeOffset+t.timestamp-this.service.state.context.baselineTime};this.timer.addAction(c)}),this.timer.addAction({doAction(){},delay:t.delay-((i=o.positions[0])==null?void 0:i.timeOffset)});break;case D.MouseInteraction:{if(o.id===-1)break;const s=new Event(Se(k[o.type])),c=this.mirror.getNode(o.id);if(!c)return this.debugNodeNotFound(o,o.id);this.emitter.emit(w.MouseInteraction,{type:o.type,target:c});const{triggerFocus:l}=this.config;switch(o.type){case k.Blur:"blur"in c&&c.blur();break;case k.Focus:l&&c.focus&&c.focus({preventScroll:!0});break;case k.Click:case k.TouchStart:case k.TouchEnd:case k.MouseDown:case k.MouseUp:n?(o.type===k.TouchStart?this.touchActive=!0:o.type===k.TouchEnd&&(this.touchActive=!1),o.type===k.MouseDown?this.lastMouseDownEvent=[c,s]:o.type===k.MouseUp&&(this.lastMouseDownEvent=null),this.mousePos={x:o.x||0,y:o.y||0,id:o.id,debugData:o}):(o.type===k.TouchStart&&(this.tailPositions.length=0),this.moveAndHover(o.x||0,o.y||0,o.id,n,o),o.type===k.Click?(this.mouse.classList.remove("active"),this.mouse.offsetWidth,this.mouse.classList.add("active")):o.type===k.TouchStart?(this.mouse.offsetWidth,this.mouse.classList.add("touch-active")):o.type===k.TouchEnd?this.mouse.classList.remove("touch-active"):c.dispatchEvent(s));break;case k.TouchCancel:n?this.touchActive=!1:this.mouse.classList.remove("touch-active");break;default:c.dispatchEvent(s)}break}case D.Scroll:{if(o.id===-1)break;if(this.usingVirtualDom){const s=this.virtualDom.mirror.getNode(o.id);if(!s)return this.debugNodeNotFound(o,o.id);s.scrollData=o;break}this.applyScroll(o,n);break}case D.ViewportResize:this.emitter.emit(w.Resize,{width:o.width,height:o.height});break;case D.Input:{if(o.id===-1)break;if(this.usingVirtualDom){const s=this.virtualDom.mirror.getNode(o.id);if(!s)return this.debugNodeNotFound(o,o.id);s.inputData=o;break}this.applyInput(o);break}case D.MediaInteraction:{const s=this.usingVirtualDom?this.virtualDom.mirror.getNode(o.id):this.mirror.getNode(o.id);if(!s)return this.debugNodeNotFound(o,o.id);const c=s,{events:l}=this.service.state.context;this.mediaManager.mediaMutation({target:c,timeOffset:t.timestamp-l[0].timestamp,mutation:o});break}case D.StyleSheetRule:case D.StyleDeclaration:{this.usingVirtualDom?o.styleId?this.constructedStyleMutations.push(o):o.id&&((r=this.virtualDom.mirror.getNode(o.id))==null||r.rules.push(o)):this.applyStyleSheetMutation(o);break}case D.CanvasMutation:{if(!this.config.UNSAFE_replayCanvas)return;if(this.usingVirtualDom){const s=this.virtualDom.mirror.getNode(o.id);if(!s)return this.debugNodeNotFound(o,o.id);s.canvasMutations.push({event:t,mutation:o})}else{const s=this.mirror.getNode(o.id);if(!s)return this.debugNodeNotFound(o,o.id);fe({event:t,mutation:o,target:s,imageMap:this.imageMap,canvasEventMap:this.canvasEventMap,errorHandler:this.warnCanvasMutationFailed.bind(this)})}break}case D.Font:{try{const s=new FontFace(o.family,o.buffer?new Uint8Array(JSON.parse(o.fontSource)):o.fontSource,o.descriptors);(a=this.iframe.contentDocument)==null||a.fonts.add(s)}catch(s){this.warn(s)}break}case D.Selection:{if(n){this.lastSelectionData=o;break}this.applySelection(o);break}case D.AdoptedStyleSheet:{this.usingVirtualDom?this.adoptedStyleSheets.push(o):this.applyAdoptedStyleSheet(o);break}}}applyMutation(t,n){if(this.config.useVirtualDom&&!this.usingVirtualDom&&n&&(this.usingVirtualDom=!0,nn(this.iframe.contentDocument,this.mirror,this.virtualDom),Object.keys(this.legacy_missingNodeRetryMap).length))for(const l in this.legacy_missingNodeRetryMap)try{const u=this.legacy_missingNodeRetryMap[l],d=Ht(u.node,this.virtualDom,this.mirror);d&&(u.node=d)}catch(u){this.warn(u)}const i=this.usingVirtualDom?this.virtualDom.mirror:this.mirror;t.removes=t.removes.filter(l=>i.getNode(l.id)?!0:(this.warnNodeNotFound(t,l.id),!1)),t.removes.forEach(l=>{var u;const d=i.getNode(l.id);if(!d)return;let h=i.getNode(l.parentId);if(!h)return this.warnNodeNotFound(t,l.parentId);if(l.isShadow&&st(h)&&(h=h.shadowRoot),i.removeNodeFromMap(d),h)try{h.removeChild(d),this.usingVirtualDom&&d.nodeName==="#text"&&h.nodeName==="STYLE"&&((u=h.rules)==null?void 0:u.length)>0&&(h.rules=[])}catch(g){if(g instanceof DOMException)this.warn("parent could not remove child in mutation",h,d,t);else throw g}});const r=rt({},this.legacy_missingNodeRetryMap),a=[],o=l=>{let u=null;return l.nextId&&(u=i.getNode(l.nextId)),l.nextId!==null&&l.nextId!==void 0&&l.nextId!==-1&&!u},s=l=>{var u,d;if(!this.iframe.contentDocument)return this.warn("Looks like your replayer has been destroyed.");let h=i.getNode(l.parentId);if(!h)return l.node.type===C.Document?this.newDocumentQueue.push(l):a.push(l);l.node.isShadow&&(st(h)||h.attachShadow({mode:"open"}),h=h.shadowRoot);let g=null,v=null;if(l.previousId&&(g=i.getNode(l.previousId)),l.nextId&&(v=i.getNode(l.nextId)),o(l))return a.push(l);if(l.node.rootId&&!i.getNode(l.node.rootId))return;const N=l.node.rootId?i.getNode(l.node.rootId):this.usingVirtualDom?this.virtualDom:this.iframe.contentDocument;if(Nt(h,i)){this.attachDocumentToIframe(l,h);return}const S=(y,M)=>{if(!this.usingVirtualDom)for(const A of this.config.plugins||[])A.onBuild&&A.onBuild(y,{id:M,replayer:this})},m=z(l.node,{doc:N,mirror:i,skipChild:!0,hackCss:!0,cache:this.cache,afterAppend:S});if(l.previousId===-1||l.nextId===-1){r[l.node.id]={node:m,mutation:l};return}const E=i.getMeta(h);if(E&&E.type===C.Element&&E.tagName==="textarea"&&l.node.type===C.Text){const y=Array.isArray(h.childNodes)?h.childNodes:Array.from(h.childNodes);for(const M of y)M.nodeType===h.TEXT_NODE&&h.removeChild(M)}else if(E?.type===C.Document){const y=h;l.node.type===C.DocumentType&&((u=y.childNodes[0])==null?void 0:u.nodeType)===Node.DOCUMENT_TYPE_NODE&&y.removeChild(y.childNodes[0]),m.nodeName==="HTML"&&y.documentElement&&y.removeChild(y.documentElement)}if(g&&g.nextSibling&&g.nextSibling.parentNode?h.insertBefore(m,g.nextSibling):v&&v.parentNode?h.contains(v)?h.insertBefore(m,v):h.insertBefore(m,null):h.appendChild(m),S(m,l.node.id),this.usingVirtualDom&&m.nodeName==="#text"&&h.nodeName==="STYLE"&&((d=h.rules)==null?void 0:d.length)>0&&(h.rules=[]),Nt(m,this.mirror)){const y=this.mirror.getId(m),M=this.newDocumentQueue.find(A=>A.parentId===y);M&&(this.attachDocumentToIframe(M,m),this.newDocumentQueue=this.newDocumentQueue.filter(A=>A!==M))}(l.previousId||l.nextId)&&this.legacy_resolveMissingNode(r,h,m,l)};t.adds.forEach(l=>{s(l)});const c=Date.now();for(;a.length;){const l=En(a);if(a.length=0,Date.now()-c>500){this.warn("Timeout in the loop, please check the resolve tree data:",l);break}for(const u of l)i.getNode(u.value.parentId)?le(u,d=>{s(d)}):this.debug("Drop resolve tree since there is no parent for the root node.",u)}Object.keys(r).length&&Object.assign(this.legacy_missingNodeRetryMap,r),Nn(t.texts).forEach(l=>{var u;const d=i.getNode(l.id);if(!d)return t.removes.find(h=>h.id===l.id)?void 0:this.warnNodeNotFound(t,l.id);if(d.textContent=l.value,this.usingVirtualDom){const h=d.parentNode;((u=h?.rules)==null?void 0:u.length)>0&&(h.rules=[])}}),t.attributes.forEach(l=>{var u;const d=i.getNode(l.id);if(!d)return t.removes.find(h=>h.id===l.id)?void 0:this.warnNodeNotFound(t,l.id);for(const h in l.attributes)if(typeof h=="string"){const g=l.attributes[h];if(g===null)d.removeAttribute(h);else if(typeof g=="string")try{if(h==="_cssText"&&(d.nodeName==="LINK"||d.nodeName==="STYLE"))try{const v=i.getMeta(d);Object.assign(v.attributes,l.attributes);const N=z(v,{doc:d.ownerDocument,mirror:i,skipChild:!0,hackCss:!0,cache:this.cache}),S=d.nextSibling,m=d.parentNode;if(N&&m){m.removeChild(d),m.insertBefore(N,S),i.replace(l.id,N);break}}catch{}if(h==="value"&&d.nodeName==="TEXTAREA"){const v=d;v.childNodes.forEach(S=>v.removeChild(S));const N=(u=d.ownerDocument)==null?void 0:u.createTextNode(g);N&&v.appendChild(N)}else d.setAttribute(h,g)}catch(v){this.warn("An error occurred may due to the checkout feature.",v)}else if(h==="style"){const v=g,N=d;for(const S in v)if(v[S]===!1)N.style.removeProperty(S);else if(v[S]instanceof Array){const m=v[S];N.style.setProperty(S,m[0],m[1])}else{const m=v[S];N.style.setProperty(S,m)}}}})}applyScroll(t,n){var i,r;const a=this.mirror.getNode(t.id);if(!a)return this.debugNodeNotFound(t,t.id);const o=this.mirror.getMeta(a);if(a===this.iframe.contentDocument)(i=this.iframe.contentWindow)==null||i.scrollTo({top:t.y,left:t.x,behavior:n?"auto":"smooth"});else if(o?.type===C.Document)(r=a.defaultView)==null||r.scrollTo({top:t.y,left:t.x,behavior:n?"auto":"smooth"});else try{a.scrollTo({top:t.y,left:t.x,behavior:n?"auto":"smooth"})}catch{}}applyInput(t){const n=this.mirror.getNode(t.id);if(!n)return this.debugNodeNotFound(t,t.id);try{n.checked=t.isChecked,n.value=t.text}catch{}}applySelection(t){try{const n=new Set,i=t.ranges.map(({start:r,startOffset:a,end:o,endOffset:s})=>{const c=this.mirror.getNode(r),l=this.mirror.getNode(o);if(!c||!l)return;const u=new Range;u.setStart(c,a),u.setEnd(l,s);const d=c.ownerDocument,h=d?.getSelection();return h&&n.add(h),{range:u,selection:h}});n.forEach(r=>r.removeAllRanges()),i.forEach(r=>{var a;return r&&((a=r.selection)==null?void 0:a.addRange(r.range))})}catch{}}applyStyleSheetMutation(t){var n;let i=null;t.styleId?i=this.styleMirror.getStyle(t.styleId):t.id&&(i=((n=this.mirror.getNode(t.id))==null?void 0:n.sheet)||null),i&&(t.source===D.StyleSheetRule?this.applyStyleSheetRule(t,i):t.source===D.StyleDeclaration&&this.applyStyleDeclaration(t,i))}applyStyleSheetRule(t,n){var i,r,a,o;if((i=t.adds)==null||i.forEach(({rule:s,index:c})=>{try{if(Array.isArray(c)){const{positions:l,index:u}=ue(c);Q(n.cssRules,l).insertRule(s,u)}else{const l=c===void 0?void 0:Math.min(c,n.cssRules.length);n?.insertRule(s,l)}}catch{}}),(r=t.removes)==null||r.forEach(({index:s})=>{try{if(Array.isArray(s)){const{positions:c,index:l}=ue(s);Q(n.cssRules,c).deleteRule(l||0)}else n?.deleteRule(s)}catch{}}),t.replace)try{(a=n.replace)==null||a.call(n,t.replace)}catch{}if(t.replaceSync)try{(o=n.replaceSync)==null||o.call(n,t.replaceSync)}catch{}}applyStyleDeclaration(t,n){t.set&&Q(n.rules,t.index).style.setProperty(t.set.property,t.set.value,t.set.priority),t.remove&&Q(n.rules,t.index).style.removeProperty(t.remove.property)}applyAdoptedStyleSheet(t){var n;const i=this.mirror.getNode(t.id);if(!i)return;(n=t.styles)==null||n.forEach(s=>{var c;let l=null,u=null;if(st(i)?u=((c=i.ownerDocument)==null?void 0:c.defaultView)||null:i.nodeName==="#document"&&(u=i.defaultView),!!u)try{l=new u.CSSStyleSheet,this.styleMirror.add(l,s.styleId),this.applyStyleSheetRule({source:D.StyleSheetRule,adds:s.rules},l)}catch{}});const r=10;let a=0;const o=(s,c)=>{const l=c.map(u=>this.styleMirror.getStyle(u)).filter(u=>u!==null);st(s)?s.shadowRoot.adoptedStyleSheets=l:s.nodeName==="#document"&&(s.adoptedStyleSheets=l),l.length!==c.length&&a<r&&(setTimeout(()=>o(s,c),0+100*a),a++)};o(i,t.styleIds)}legacy_resolveMissingNode(t,n,i,r){const{previousId:a,nextId:o}=r,s=a&&t[a],c=o&&t[o];if(s){const{node:l,mutation:u}=s;n.insertBefore(l,i),delete t[u.node.id],delete this.legacy_missingNodeRetryMap[u.node.id],(u.previousId||u.nextId)&&this.legacy_resolveMissingNode(t,n,l,u)}if(c){const{node:l,mutation:u}=c;n.insertBefore(l,i.nextSibling),delete t[u.node.id],delete this.legacy_missingNodeRetryMap[u.node.id],(u.previousId||u.nextId)&&this.legacy_resolveMissingNode(t,n,l,u)}}moveAndHover(t,n,i,r,a){const o=this.mirror.getNode(i);if(!o)return this.debugNodeNotFound(a,i);const s=ce(o,this.iframe),c=t*s.absoluteScale+s.x,l=n*s.absoluteScale+s.y;this.mouse.style.left=`${c}px`,this.mouse.style.top=`${l}px`,r||this.drawMouseTail({x:c,y:l}),this.hoverElements(o)}drawMouseTail(t){if(!this.mouseTail)return;const{lineCap:n,lineWidth:i,strokeStyle:r,duration:a}=this.config.mouseTail===!0?St:Object.assign({},St,this.config.mouseTail),o=()=>{if(!this.mouseTail)return;const s=this.mouseTail.getContext("2d");!s||!this.tailPositions.length||(s.clearRect(0,0,this.mouseTail.width,this.mouseTail.height),s.beginPath(),s.lineWidth=i,s.lineCap=n,s.strokeStyle=r,s.moveTo(this.tailPositions[0].x,this.tailPositions[0].y),this.tailPositions.forEach(c=>s.lineTo(c.x,c.y)),s.stroke())};this.tailPositions.push(t),o(),setTimeout(()=>{this.tailPositions=this.tailPositions.filter(s=>s!==t),o()},a/this.speedService.state.context.timer.speed)}hoverElements(t){var n;(n=this.lastHoveredRootNode||this.iframe.contentDocument)==null||n.querySelectorAll(".\\:hover").forEach(r=>{r.classList.remove(":hover")}),this.lastHoveredRootNode=t.getRootNode();let i=t;for(;i;)i.classList&&i.classList.add(":hover"),i=i.parentElement}isUserInteraction(t){return t.type!==R.IncrementalSnapshot?!1:t.data.source>D.Mutation&&t.data.source<=D.Input}backToNormal(){this.nextUserInteractionEvent=null,!this.speedService.state.matches("normal")&&(this.speedService.send({type:"BACK_TO_NORMAL"}),this.emitter.emit(w.SkipEnd,{speed:this.speedService.state.context.normalSpeed}))}warnNodeNotFound(t,n){this.warn(`Node with id '${n}' not found. `,t)}warnCanvasMutationFailed(t,n){this.warn("Has error on canvas update",n,"canvas mutation:",t)}debugNodeNotFound(t,n){this.debug(`Node with id '${n}' not found. `,t)}warn(...t){!this.config.showWarning||this.config.logger.warn(ve,...t)}debug(...t){!this.config.showDebug||this.config.logger.log(ve,...t)}}return ut.Replayer=Un,Object.defineProperty(ut,"__esModule",{value:!0}),ut}({});
//# sourceMappingURL=rrweb-replay.min.js.map
